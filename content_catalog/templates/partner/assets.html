{% extends "partner/base.html" %}

{% block title %}My Assets - Partner Portal{% endblock %}

{% block page_title %}My Assets{% endblock %}

{% block header_actions %}
<a href="{{ url_for('partner.upload') }}" class="btn btn-primary">
    <span>&#8679;</span> Upload New
</a>
{% endblock %}

{% block extra_styles %}
<style>
/* Page Layout with Folder Sidebar */
.assets-layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    gap: 24px;
}

@media (max-width: 900px) {
    .assets-layout {
        grid-template-columns: 1fr;
    }
}

/* Folder Sidebar */
.folder-sidebar {
    background: var(--bg-card);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--border-light);
    padding: 16px;
    height: fit-content;
    position: sticky;
    top: 100px;
}

.folder-sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.folder-sidebar-header h3 {
    font-size: 14px;
    color: var(--text-primary);
    font-weight: 600;
    margin: 0;
}

.folder-add-btn {
    background: rgba(6, 182, 212, 0.2);
    color: var(--primary);
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.folder-add-btn:hover {
    background: rgba(6, 182, 212, 0.35);
}

.folder-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.folder-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    text-decoration: none;
    color: var(--text-secondary);
    font-size: 13px;
    margin-bottom: 2px;
}

.folder-item:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--text-primary);
}

.folder-item.active {
    background: rgba(6, 182, 212, 0.15);
    color: var(--primary);
    font-weight: 600;
}

.folder-item-left {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    min-width: 0;
}

.folder-item-left span.name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.folder-count {
    background: rgba(255, 255, 255, 0.08);
    padding: 2px 7px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
    flex-shrink: 0;
}

.folder-item.active .folder-count {
    background: rgba(6, 182, 212, 0.3);
}

.folder-menu-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 4px;
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.15s;
}

.folder-item:hover .folder-menu-btn {
    opacity: 1;
}

.folder-menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
}

.folder-divider {
    border: none;
    border-top: 1px solid var(--border-light);
    margin: 8px 0;
}

/* Filter Section */
.filter-section {
    background: var(--bg-card);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--border-light);
    padding: 20px 24px;
    margin-bottom: 24px;
}

.filter-section h3 {
    font-size: 16px;
    color: var(--text-primary);
    margin-bottom: 16px;
    font-weight: 600;
}

.filter-tabs {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.filter-tab {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    text-decoration: none;
}

.filter-tab:hover {
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--border-medium);
}

.filter-tab.active {
    border-color: var(--primary);
    background: rgba(6, 182, 212, 0.1);
    color: var(--text-primary);
}

.filter-tab .count {
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.filter-tab.active .count {
    background: var(--primary);
    color: var(--bg-dark);
}

/* Assets Grid */
.assets-section {
    background: var(--bg-card);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--border-light);
    padding: 24px;
    margin-bottom: 24px;
}

.assets-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.assets-section h3 {
    font-size: 18px;
    color: var(--text-primary);
    font-weight: 600;
}

.assets-count {
    color: var(--text-muted);
    font-size: 14px;
}

.assets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

/* Asset Card */
.asset-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--border-radius);
    border: 1px solid var(--border-light);
    transition: all 0.3s;
    cursor: pointer;
    overflow: hidden;
}

.asset-card:hover {
    transform: translateY(-4px);
    border-color: var(--primary);
    box-shadow: 0 8px 24px rgba(6, 182, 212, 0.15);
}

.asset-preview {
    position: relative;
    width: 100%;
    height: 160px;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.asset-preview img,
.asset-preview video {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.asset-preview-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    color: var(--text-muted);
}

.asset-preview-placeholder .icon {
    font-size: 40px;
    opacity: 0.5;
}

.asset-preview-placeholder .text {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.duration-badge {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    font-family: monospace;
}

.asset-networks {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 12px 16px;
    background: rgba(0, 0, 0, 0.2);
    border-bottom: 1px solid var(--border-light);
}

.network-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 10px;
    background: rgba(6, 182, 212, 0.2);
    color: var(--primary);
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
}

.network-badge .icon { font-size: 10px; }

.asset-card-body { padding: 16px; }

.asset-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.asset-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
    line-height: 1.3;
    word-break: break-word;
}

.asset-filename {
    font-size: 12px;
    color: var(--text-muted);
    word-break: break-all;
}

.asset-status {
    flex-shrink: 0;
    margin-left: 12px;
}

.status-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-draft { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }
.status-pending_review { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
.status-approved { background: rgba(16, 185, 129, 0.2); color: #34d399; }
.status-rejected { background: rgba(239, 68, 68, 0.2); color: #f87171; }
.status-published { background: rgba(6, 182, 212, 0.2); color: #22d3ee; }
.status-archived { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }

.asset-meta {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-light);
}

.meta-item { display: flex; flex-direction: column; gap: 2px; }
.meta-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
.meta-value { font-size: 13px; font-weight: 500; color: var(--text-secondary); }

.asset-actions {
    display: flex;
    gap: 8px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-light);
}

.asset-actions .btn { flex: 1; padding: 8px 12px; font-size: 12px; }

.empty-state { text-align: center; padding: 60px 20px; }
.empty-state-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }
.empty-state h3 { font-size: 20px; color: var(--text-primary); margin-bottom: 8px; }
.empty-state p { color: var(--text-muted); margin-bottom: 24px; }

.asset-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; }
.asset-tag { background: rgba(139, 92, 246, 0.2); color: #a78bfa; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
.asset-category { background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
.asset-folder-badge { background: rgba(16, 185, 129, 0.2); color: #34d399; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }

.asset-description {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Context Menu */
.folder-context-menu {
    position: fixed;
    background: var(--bg-card);
    border: 1px solid var(--border-medium);
    border-radius: 8px;
    padding: 6px;
    min-width: 140px;
    z-index: 1000;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    display: none;
}

.folder-context-menu button {
    display: block;
    width: 100%;
    text-align: left;
    padding: 8px 12px;
    border: none;
    background: none;
    color: var(--text-secondary);
    font-size: 13px;
    cursor: pointer;
    border-radius: 6px;
}

.folder-context-menu button:hover {
    background: rgba(255, 255, 255, 0.08);
    color: var(--text-primary);
}

.folder-context-menu button.danger { color: #f87171; }
.folder-context-menu button.danger:hover { background: rgba(239, 68, 68, 0.15); }

/* Move Modal */
.move-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
}

.move-modal-overlay.visible { display: flex; }

.move-modal {
    background: var(--bg-card);
    border: 1px solid var(--border-medium);
    border-radius: var(--border-radius-lg);
    padding: 24px;
    width: 380px;
    max-width: 90vw;
}

.move-modal h3 {
    color: var(--text-primary);
    font-size: 16px;
    margin-bottom: 16px;
}

.move-modal-folders {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 16px;
}

.move-folder-option {
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    color: var(--text-secondary);
    font-size: 14px;
    transition: all 0.15s;
}

.move-folder-option:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--text-primary);
}

.move-folder-option.selected {
    background: rgba(6, 182, 212, 0.15);
    color: var(--primary);
}

.move-modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

/* New Folder Modal */
.new-folder-modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
}

.new-folder-modal-overlay.visible { display: flex; }

.new-folder-modal {
    background: var(--bg-card);
    border: 1px solid var(--border-medium);
    border-radius: var(--border-radius-lg);
    padding: 24px;
    width: 360px;
    max-width: 90vw;
}

.new-folder-modal h3 {
    color: var(--text-primary);
    font-size: 16px;
    margin-bottom: 16px;
}

.new-folder-modal input {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid var(--border-light);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    font-size: 14px;
    margin-bottom: 16px;
}

.new-folder-modal input:focus {
    outline: none;
    border-color: var(--primary);
}

.new-folder-modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}
</style>
{% endblock %}

{% block content %}
<div class="assets-layout">
    <!-- Folder Sidebar -->
    <div class="folder-sidebar animate-fade-in">
        <div class="folder-sidebar-header">
            <h3>Folders</h3>
            <button class="folder-add-btn" onclick="showNewFolderModal()" title="New Folder">+</button>
        </div>
        <ul class="folder-list">
            <li>
                <a href="{{ url_for('partner.assets', status=status_filter) if status_filter else url_for('partner.assets') }}"
                   class="folder-item {% if not folder_filter %}active{% endif %}">
                    <span class="folder-item-left">
                        <span>&#128193;</span>
                        <span class="name">All Assets</span>
                    </span>
                    <span class="folder-count">{{ total_count }}</span>
                </a>
            </li>
            {% for folder in folders %}
            <li>
                <a href="{{ url_for('partner.assets', folder=folder.id, status=status_filter) if status_filter else url_for('partner.assets', folder=folder.id) }}"
                   class="folder-item {% if folder_filter == folder.id|string %}active{% endif %}">
                    <span class="folder-item-left">
                        <span>&#128194;</span>
                        <span class="name">{{ folder.name }}</span>
                    </span>
                    <span class="folder-count">{{ folder_counts.get(folder.id|string, 0) }}</span>
                    <button class="folder-menu-btn" onclick="event.preventDefault(); event.stopPropagation(); showFolderMenu(event, {{ folder.id }}, '{{ folder.name }}')">&#8942;</button>
                </a>
            </li>
            {% endfor %}
            <hr class="folder-divider">
            <li>
                <a href="{{ url_for('partner.assets', folder='uncategorized', status=status_filter) if status_filter else url_for('partner.assets', folder='uncategorized') }}"
                   class="folder-item {% if folder_filter == 'uncategorized' %}active{% endif %}">
                    <span class="folder-item-left">
                        <span>&#128196;</span>
                        <span class="name">Uncategorized</span>
                    </span>
                    <span class="folder-count">{{ uncategorized_count }}</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Filter Section -->
        <div class="filter-section animate-fade-in">
            <h3>&#128269; Filter by Status</h3>
            <div class="filter-tabs">
                <a href="{{ url_for('partner.assets', folder=folder_filter) if folder_filter else url_for('partner.assets') }}" class="filter-tab {% if not status_filter %}active{% endif %}">
                    &#128193; All
                    <span class="count">{{ total_count }}</span>
                </a>
                <a href="{{ url_for('partner.assets', status='draft', folder=folder_filter) if folder_filter else url_for('partner.assets', status='draft') }}" class="filter-tab {% if status_filter == 'draft' %}active{% endif %}">
                    &#128221; Drafts
                    <span class="count">{{ draft_count }}</span>
                </a>
                <a href="{{ url_for('partner.assets', status='pending_review', folder=folder_filter) if folder_filter else url_for('partner.assets', status='pending_review') }}" class="filter-tab {% if status_filter == 'pending_review' %}active{% endif %}">
                    &#9203; Pending
                    <span class="count">{{ pending_count }}</span>
                </a>
                <a href="{{ url_for('partner.assets', status='approved', folder=folder_filter) if folder_filter else url_for('partner.assets', status='approved') }}" class="filter-tab {% if status_filter == 'approved' %}active{% endif %}">
                    &#10003; Approved
                    <span class="count">{{ approved_count }}</span>
                </a>
                <a href="{{ url_for('partner.assets', status='rejected', folder=folder_filter) if folder_filter else url_for('partner.assets', status='rejected') }}" class="filter-tab {% if status_filter == 'rejected' %}active{% endif %}">
                    &#10007; Rejected
                    <span class="count">{{ rejected_count }}</span>
                </a>
                <a href="{{ url_for('partner.assets', status='published', folder=folder_filter) if folder_filter else url_for('partner.assets', status='published') }}" class="filter-tab {% if status_filter == 'published' %}active{% endif %}">
                    &#127760; Published
                    <span class="count">{{ published_count }}</span>
                </a>
            </div>
        </div>

        <!-- Assets Grid Section -->
        <div class="assets-section animate-fade-in">
            <div class="assets-header">
                <h3>
                    {% if folder_filter == 'uncategorized' %}&#128196; Uncategorized
                    {% elif folder_filter %}&#128194; {{ folders|selectattr('id', 'equalto', folder_filter|int)|map(attribute='name')|first|default('Folder') }}
                    {% elif status_filter == 'draft' %}&#128221; Draft Assets
                    {% elif status_filter == 'pending_review' %}&#9203; Pending Review
                    {% elif status_filter == 'approved' %}&#10003; Approved Assets
                    {% elif status_filter == 'rejected' %}&#10007; Rejected Assets
                    {% elif status_filter == 'published' %}&#127760; Published Assets
                    {% else %}&#128193; All Assets
                    {% endif %}
                </h3>
                <span class="assets-count">{{ assets|length }} asset{% if assets|length != 1 %}s{% endif %}</span>
            </div>

            {% if assets %}
            <div class="assets-grid">
                {% for asset in assets %}
                <div class="asset-card" data-id="{{ asset.id }}">
                    <div class="asset-preview">
                        {% set is_video = asset.format in ['mp4', 'avi', 'mov', 'mkv', 'webm'] %}
                        {% set is_image = asset.format in ['jpg', 'jpeg', 'png', 'gif', 'webp'] %}
                        {% if is_video %}
                        <video src="/uploads/{{ asset.filename }}" preload="metadata"></video>
                        {% if asset.duration %}
                        <span class="duration-badge">{{ '%d:%02d'|format((asset.duration // 60)|int, (asset.duration % 60)|int) }}</span>
                        {% endif %}
                        {% elif is_image %}
                        <img src="/uploads/{{ asset.filename }}" alt="{{ asset.title }}">
                        {% else %}
                        <div class="asset-preview-placeholder">
                            <span class="icon">&#128196;</span>
                            <span class="text">{{ asset.format|upper if asset.format else 'FILE' }}</span>
                        </div>
                        {% endif %}
                    </div>

                    {% if asset.venue_approvals %}
                    <div class="asset-networks">
                        {% for approval in asset.venue_approvals %}
                        <span class="network-badge">
                            <span class="icon">&#127760;</span>
                            {{ approval.tenant.name if approval.tenant else 'Unknown' }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="asset-card-body">
                        <div class="asset-header">
                            <div>
                                <div class="asset-title">{{ asset.title }}</div>
                                <div class="asset-filename">{{ asset.filename }}</div>
                            </div>
                            <div class="asset-status">
                                <span class="status-badge status-{{ asset.status }}">
                                    {% if asset.status == 'draft' %}Draft
                                    {% elif asset.status == 'pending_review' %}Pending
                                    {% elif asset.status == 'approved' %}Approved
                                    {% elif asset.status == 'rejected' %}Rejected
                                    {% elif asset.status == 'published' %}Published
                                    {% elif asset.status == 'archived' %}Archived
                                    {% else %}{{ asset.status }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        {% if asset.description %}
                        <div class="asset-description">{{ asset.description }}</div>
                        {% endif %}

                        <div class="asset-tags">
                            {% if asset.asset_category %}
                            <span class="asset-folder-badge">&#128194; {{ asset.asset_category.name }}</span>
                            {% endif %}
                            {% if asset.category %}
                            <span class="asset-category">{{ asset.category }}</span>
                            {% endif %}
                            {% if asset.tags %}
                                {% for tag in asset.tags.split(',')[:3] %}
                                <span class="asset-tag">{{ tag.strip() }}</span>
                                {% endfor %}
                            {% endif %}
                        </div>

                        <div class="asset-meta">
                            <div class="meta-item">
                                <span class="meta-label">Format</span>
                                <span class="meta-value">{{ asset.format|upper if asset.format else 'Unknown' }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Size</span>
                                <span class="meta-value">
                                    {% if asset.file_size %}
                                        {{ (asset.file_size / 1024 / 1024)|round(1) }} MB
                                    {% else %}
                                        Unknown
                                    {% endif %}
                                </span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Created</span>
                                <span class="meta-value">{{ asset.created_at.strftime('%b %d, %Y') if asset.created_at else 'Unknown' }}</span>
                            </div>
                            {% if asset.status == 'published' and asset.published_at %}
                            <div class="meta-item">
                                <span class="meta-label">Published</span>
                                <span class="meta-value">{{ asset.published_at.strftime('%b %d, %Y') }}</span>
                            </div>
                            {% endif %}
                        </div>

                        <div class="asset-actions">
                            {% if asset.status == 'draft' %}
                            <a href="{{ url_for('partner.upload') }}?edit={{ asset.uuid }}" class="btn btn-secondary btn-sm">&#9998; Edit</a>
                            <button class="btn btn-primary btn-sm" onclick="submitForReview('{{ asset.uuid }}')">&#10003; Submit</button>
                            {% elif asset.status == 'rejected' %}
                            <a href="{{ url_for('partner.upload') }}?edit={{ asset.uuid }}" class="btn btn-secondary btn-sm">&#9998; Edit &amp; Resubmit</a>
                            {% elif asset.status == 'pending_review' %}
                            <button class="btn btn-secondary btn-sm" disabled>&#9203; Awaiting Review</button>
                            {% elif asset.status == 'approved' or asset.status == 'published' %}
                            <button class="btn btn-secondary btn-sm" onclick="viewAsset('{{ asset.uuid }}')">&#128065; View Details</button>
                            {% endif %}
                            <button class="btn btn-secondary btn-sm" onclick="openMoveModal({{ asset.id }})" title="Move to folder">&#128194;</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    {% if folder_filter == 'uncategorized' %}&#128196;
                    {% elif folder_filter %}&#128194;
                    {% elif status_filter == 'draft' %}&#128221;
                    {% elif status_filter == 'pending_review' %}&#9203;
                    {% elif status_filter == 'approved' %}&#10003;
                    {% elif status_filter == 'rejected' %}&#10007;
                    {% elif status_filter == 'published' %}&#127760;
                    {% else %}&#128193;
                    {% endif %}
                </div>
                <h3>
                    {% if folder_filter == 'uncategorized' %}No uncategorized assets
                    {% elif folder_filter %}No assets in this folder
                    {% elif status_filter %}No {{ status_filter|replace('_', ' ') }} assets
                    {% else %}No assets yet
                    {% endif %}
                </h3>
                <p>
                    {% if folder_filter %}Move assets here or upload new content.
                    {% elif status_filter == 'draft' %}Create a new upload to get started with drafts.
                    {% elif status_filter == 'pending_review' %}No assets are currently awaiting review.
                    {% elif status_filter == 'approved' %}No approved assets yet. Submit content for review to get started.
                    {% elif status_filter == 'rejected' %}No rejected assets. Keep up the good work!
                    {% elif status_filter == 'published' %}No published content yet. Submit and get approved to publish.
                    {% else %}Upload your first content to get started with the partner portal.
                    {% endif %}
                </p>
                <a href="{{ url_for('partner.upload') }}" class="btn btn-primary">
                    <span>&#8679;</span> Upload Content
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- New Folder Modal -->
<div class="new-folder-modal-overlay" id="newFolderOverlay">
    <div class="new-folder-modal">
        <h3>Create New Folder</h3>
        <input type="text" id="newFolderName" placeholder="Folder name" autofocus>
        <div class="new-folder-modal-actions">
            <button class="btn btn-secondary btn-sm" onclick="hideNewFolderModal()">Cancel</button>
            <button class="btn btn-primary btn-sm" onclick="createFolder()">Create</button>
        </div>
    </div>
</div>

<!-- Move to Folder Modal -->
<div class="move-modal-overlay" id="moveOverlay">
    <div class="move-modal">
        <h3>Move to Folder</h3>
        <div class="move-modal-folders" id="moveFolderList"></div>
        <div class="move-modal-actions">
            <button class="btn btn-secondary btn-sm" onclick="hideMoveModal()">Cancel</button>
            <button class="btn btn-primary btn-sm" id="moveConfirmBtn" onclick="confirmMove()">Move</button>
        </div>
    </div>
</div>

<!-- Folder Context Menu -->
<div class="folder-context-menu" id="folderContextMenu">
    <button onclick="renameFolderFromMenu()">Rename</button>
    <button class="danger" onclick="deleteFolderFromMenu()">Delete</button>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let contextFolderId = null;
    let contextFolderName = '';
    let moveAssetId = null;
    let moveTargetFolderId = null;

    // Submit asset for review
    function submitForReview(assetUuid) {
        if (!confirm('Submit this asset for review? You can still make changes while it is pending.')) {
            return;
        }
        fetch('/partner/api/assets/' + assetUuid + '/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
            if (response.ok) {
                setTimeout(() => location.reload(), 500);
            } else {
                return response.json().then(data => {
                    alert('Error: ' + (data.error || 'Failed to submit for review'));
                });
            }
        })
        .catch(error => alert('Error: ' + error.message));
    }

    function viewAsset(assetUuid) {
        alert('Asset details view coming soon. UUID: ' + assetUuid);
    }

    // New Folder
    function showNewFolderModal() {
        document.getElementById('newFolderOverlay').classList.add('visible');
        document.getElementById('newFolderName').value = '';
        document.getElementById('newFolderName').focus();
    }

    function hideNewFolderModal() {
        document.getElementById('newFolderOverlay').classList.remove('visible');
    }

    function createFolder() {
        const name = document.getElementById('newFolderName').value.trim();
        if (!name) return;

        fetch('/partner/api/folders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name })
        })
        .then(r => {
            if (r.ok) { location.reload(); }
            else { return r.json().then(d => alert(d.error || 'Failed to create folder')); }
        })
        .catch(e => alert('Error: ' + e.message));
    }

    // Enter key to create folder
    document.getElementById('newFolderName').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') createFolder();
        if (e.key === 'Escape') hideNewFolderModal();
    });

    // Folder Context Menu
    function showFolderMenu(event, folderId, folderName) {
        contextFolderId = folderId;
        contextFolderName = folderName;
        const menu = document.getElementById('folderContextMenu');
        menu.style.display = 'block';
        menu.style.left = event.clientX + 'px';
        menu.style.top = event.clientY + 'px';
    }

    document.addEventListener('click', function(e) {
        const menu = document.getElementById('folderContextMenu');
        if (!e.target.closest('.folder-context-menu') && !e.target.closest('.folder-menu-btn')) {
            menu.style.display = 'none';
        }
    });

    function renameFolderFromMenu() {
        document.getElementById('folderContextMenu').style.display = 'none';
        const newName = prompt('Rename folder:', contextFolderName);
        if (!newName || newName.trim() === contextFolderName) return;

        fetch('/partner/api/folders/' + contextFolderId, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: newName.trim() })
        })
        .then(r => {
            if (r.ok) { location.reload(); }
            else { return r.json().then(d => alert(d.error || 'Failed to rename')); }
        })
        .catch(e => alert('Error: ' + e.message));
    }

    function deleteFolderFromMenu() {
        document.getElementById('folderContextMenu').style.display = 'none';
        if (!confirm('Delete folder "' + contextFolderName + '"? Assets will become uncategorized.')) return;

        fetch('/partner/api/folders/' + contextFolderId, { method: 'DELETE' })
        .then(r => {
            if (r.ok) { location.reload(); }
            else { return r.json().then(d => alert(d.error || 'Failed to delete')); }
        })
        .catch(e => alert('Error: ' + e.message));
    }

    // Move Asset to Folder
    function openMoveModal(assetId) {
        moveAssetId = assetId;
        moveTargetFolderId = null;
        const list = document.getElementById('moveFolderList');
        list.innerHTML = '<div class="move-folder-option" onclick="selectMoveTarget(null, this)">&#128196; Uncategorized</div>';

        fetch('/partner/api/folders')
        .then(r => r.json())
        .then(data => {
            (data.folders || []).forEach(f => {
                list.innerHTML += '<div class="move-folder-option" onclick="selectMoveTarget(' + f.id + ', this)">&#128194; ' + f.name + '</div>';
            });
        });

        document.getElementById('moveOverlay').classList.add('visible');
    }

    function hideMoveModal() {
        document.getElementById('moveOverlay').classList.remove('visible');
    }

    function selectMoveTarget(folderId, el) {
        moveTargetFolderId = folderId;
        document.querySelectorAll('.move-folder-option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
    }

    function confirmMove() {
        fetch('/partner/api/assets/' + moveAssetId + '/move', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ folder_id: moveTargetFolderId })
        })
        .then(r => {
            if (r.ok) { location.reload(); }
            else { return r.json().then(d => alert(d.error || 'Failed to move')); }
        })
        .catch(e => alert('Error: ' + e.message));
    }
</script>
{% endblock %}
