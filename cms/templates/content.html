{% extends "base.html" %}

{% block title %}Content Library - Skillz Media Screens CMS{% endblock %}

{% block extra_styles %}
.layout {
    display: grid;
    grid-template-columns: 1fr 500px;
    gap: 20px;
    margin-top: 20px;
}

.main-content {
    min-width: 0;
}

.preview-panel {
    position: sticky;
    top: 20px;
    height: fit-content;
}

/* Networks Section */
.networks-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.networks-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.networks-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.networks-grid {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.network-btn {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    color: #64748b;
}

.network-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.network-btn.active {
    border-color: #667eea;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    color: #667eea;
}

.network-btn .count {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

/* Partners Section */
.partners-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.partners-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.partners-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.partners-grid {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.partner-btn {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    color: #64748b;
}

.partner-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.partner-btn.active {
    border-color: #10b981;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    color: #10b981;
}

.partner-btn .count {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

/* Content Type Section */
.content-type-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.content-type-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.content-type-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.content-type-grid {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.content-type-btn {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    color: #64748b;
}

.content-type-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.content-type-btn.active {
    border-color: #f59e0b;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    color: #f59e0b;
}

.content-type-btn .count {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

/* Folders Section */
.folders-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.folders-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.folders-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.create-folder-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
}

.create-folder-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.folders-grid {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.folder-btn {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
}

.folder-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.folder-btn.active {
    border-color: currentColor;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.folder-btn .count {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.delete-folder {
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 2px 6px;
    font-size: 12px;
    cursor: pointer;
    margin-left: 8px;
    opacity: 0;
    transition: opacity 0.2s;
}

.folder-btn:hover .delete-folder {
    opacity: 1;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.modal-header h3 {
    font-size: 22px;
    color: #1e293b;
    font-weight: 700;
}

.close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #64748b;
    transition: color 0.2s;
}

.close-btn:hover {
    color: #1e293b;
}

/* Icon Picker */
.icon-picker {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 8px;
    margin: 15px 0;
}

.icon-option {
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    text-align: center;
    font-size: 24px;
    transition: all 0.2s;
}

.icon-option:hover {
    border-color: #667eea;
    transform: scale(1.1);
}

.icon-option.selected {
    border-color: #667eea;
    background: #eef2ff;
}

/* Color Picker */
.color-picker {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    margin: 15px 0;
}

.color-option {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.selected {
    border-color: #1e293b;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.form-group {
    margin: 20px 0;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #475569;
    font-weight: 600;
    font-size: 14px;
}

.form-group input, .form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.2s;
}

.form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* Content Grid */
.content-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.content-section h3 {
    font-size: 18px;
    color: #1e293b;
    margin-bottom: 20px;
    font-weight: 700;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.content-card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s;
    cursor: pointer;
    border: 2px solid transparent;
}

.content-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    border-color: #667eea;
}

.content-card.active {
    border-color: #667eea;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
}

.content-title {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 10px;
}

.content-info {
    color: #64748b;
    font-size: 13px;
    margin: 6px 0;
}

.folder-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    margin-top: 10px;
}

/* Content Card Thumbnail */
.content-thumbnail {
    width: 100%;
    height: 140px;
    background: #f1f5f9;
    border-radius: 10px;
    margin-bottom: 12px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.content-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.content-thumbnail .no-thumbnail {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #94a3b8;
    font-size: 36px;
}

.content-thumbnail .no-thumbnail span {
    font-size: 11px;
    margin-top: 4px;
}

/* Status Badge */
.status-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 10px;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.approved {
    background: #dcfce7;
    color: #16a34a;
}

.status-badge.published {
    background: #dbeafe;
    color: #2563eb;
}

.status-badge.pending {
    background: #fef3c7;
    color: #d97706;
}

.status-badge.pending_review {
    background: #fef3c7;
    color: #d97706;
}

.status-badge.rejected {
    background: #fee2e2;
    color: #dc2626;
}

.status-badge.draft {
    background: #f1f5f9;
    color: #64748b;
}

/* Partner Badge */
.partner-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    background: #f0fdf4;
    color: #16a34a;
    margin-top: 8px;
}

.partner-badge.no-partner {
    background: #f1f5f9;
    color: #64748b;
}

/* Content Card Meta Row */
.content-meta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 10px;
}

/* Sync Section */
.sync-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.sync-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sync-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.sync-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

.sync-btn {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
}

.sync-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.sync-btn:disabled {
    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.sync-btn.syncing {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.sync-btn .sync-icon {
    transition: transform 0.5s ease;
}

.sync-btn.syncing .sync-icon {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.sync-timestamp {
    font-size: 13px;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 6px;
}

.sync-timestamp .timestamp-label {
    font-weight: 500;
}

.sync-timestamp .timestamp-value {
    color: #1e293b;
    font-weight: 600;
}

.sync-status {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-top: 15px;
}

.sync-stat {
    background: #f8fafc;
    padding: 12px 16px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.sync-stat .stat-label {
    font-size: 12px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.sync-stat .stat-value {
    font-size: 14px;
    font-weight: 700;
    color: #1e293b;
}

.sync-stat.success {
    background: #dcfce7;
}

.sync-stat.success .stat-value {
    color: #16a34a;
}

.sync-stat.warning {
    background: #fef3c7;
}

.sync-stat.warning .stat-value {
    color: #d97706;
}

.sync-stat.error {
    background: #fee2e2;
}

.sync-stat.error .stat-value {
    color: #dc2626;
}

/* Player Box */
.player-box {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.player-box h3 {
    font-size: 16px;
    color: #1e293b;
    margin-bottom: 15px;
    font-weight: 700;
}

.player-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
}

.player-container video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.no-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #94a3b8;
    flex-direction: column;
    padding: 40px 20px;
}

.no-preview svg {
    width: 60px;
    height: 60px;
    margin-bottom: 15px;
    opacity: 0.3;
}

.player-info {
    margin-top: 15px;
}

.player-title {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 10px;
}

.player-meta {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

.meta-item {
    background: #f8fafc;
    padding: 12px;
    border-radius: 8px;
}

.meta-label {
    font-size: 11px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.meta-value {
    font-size: 14px;
    font-weight: 600;
    color: #1e293b;
    margin-top: 5px;
}


/* Drop Zone Styles */
.drop-zone-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(102, 126, 234, 0.15);
    border: 4px dashed #667eea;
    z-index: 9999;
    align-items: center;
    justify-content: center;
}

.drop-zone-overlay.active {
    display: flex;
}

.drop-zone-message {
    background: white;
    padding: 40px 60px;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    text-align: center;
}

.drop-zone-message .drop-icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.drop-zone-message h3 {
    font-size: 24px;
    color: #1e293b;
    margin-bottom: 10px;
}

.drop-zone-message p {
    color: #64748b;
    font-size: 16px;
}

.drop-toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: white;
    padding: 20px 30px;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    gap: 15px;
    z-index: 10000;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
}

.drop-toast.show {
    transform: translateX(0);
    opacity: 1;
}

.drop-toast.success {
    border-left: 4px solid #10b981;
}

.drop-toast.error {
    border-left: 4px solid #ef4444;
}

.drop-toast .toast-icon {
    font-size: 32px;
}

.drop-toast .toast-content h4 {
    font-size: 16px;
    color: #1e293b;
    margin: 0 0 4px 0;
}

.drop-toast .toast-content p {
    font-size: 14px;
    color: #64748b;
    margin: 0;
}

.content-section.drop-target {
    border: 3px dashed #667eea !important;
    background: rgba(102, 126, 234, 0.05) !important;
}

/* Upload Button */
.upload-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.upload-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
    margin: 0;
}

.upload-actions {
    display: flex;
    gap: 12px;
}

.upload-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
}

.upload-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

/* Upload Modal */
.upload-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1001;
    align-items: center;
    justify-content: center;
}

.upload-modal.active {
    display: flex;
}

.upload-modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.upload-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.upload-modal-header h3 {
    font-size: 22px;
    color: #1e293b;
    font-weight: 700;
    margin: 0;
}

.upload-close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #64748b;
}

.upload-form-group {
    margin-bottom: 20px;
}

.upload-form-group label {
    display: block;
    margin-bottom: 8px;
    color: #475569;
    font-weight: 600;
    font-size: 14px;
}

.upload-form-group input,
.upload-form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 14px;
    box-sizing: border-box;
}

.upload-form-group input:focus,
.upload-form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.upload-submit-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    width: 100%;
}

{% endblock %}

{% block content %}

<!-- Drop Zone Overlay -->
<div class="layout">
    <div class="main-content">
        <h2 style="margin: 20px 0 15px 0; color: white; font-size: 24px; font-weight: 700;">üìÅ Content Library</h2>

        <!-- Upload Section -->
        <div class="upload-section">
            <h3>üì§ Add Content</h3>
            <div class="upload-actions">
                <button class="upload-btn" onclick="openUploadModal()">
                    <span>üìÅ</span> Upload Local File
                </button>
                <span style="color: #64748b; font-size: 14px;">or drag from Content Catalog</span>
            </div>
        </div>

        <!-- Sync Section -->
        <div class="sync-section">
            <div class="sync-header">
                <h3>üîÑ Content Catalog Sync</h3>
                <div class="sync-controls">
                    <div class="sync-timestamp" id="syncTimestamp">
                        <span class="timestamp-label">Last synced:</span>
                        <span class="timestamp-value" id="lastSyncTime">Loading...</span>
                    </div>
                    <button class="sync-btn" id="syncBtn" onclick="syncContent()">
                        <span class="sync-icon">üîÑ</span>
                        <span class="sync-text">Sync Now</span>
                    </button>
                </div>
            </div>
            <div class="sync-status" id="syncStatus">
                <div class="sync-stat" id="syncStatTotal">
                    <span class="stat-label">Total Synced:</span>
                    <span class="stat-value" id="totalSynced">-</span>
                </div>
                <div class="sync-stat" id="syncStatCatalog">
                    <span class="stat-label">Catalog Status:</span>
                    <span class="stat-value" id="catalogStatus">Checking...</span>
                </div>
            </div>
        </div>

        <!-- Network Filter -->
        <div class="networks-section">
            <div class="networks-header">
                <h3>üåê Networks</h3>
            </div>
            <div class="networks-grid">
                <button class="network-btn active" onclick="filterNetwork(null)">
                    üåç All Networks
                    <span class="count" id="network-count-all">{{ content|length }}</span>
                </button>
                {% for network in networks %}
                <button class="network-btn" data-network-id="{{ network.slug }}" onclick="filterNetwork('{{ network.slug }}')">
                    üì° {{ network.name }}
                    <span class="count" id="network-count-{{ network.slug }}">0</span>
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Partner Filter -->
        <div class="partners-section">
            <div class="partners-header">
                <h3>üè¢ Partners</h3>
            </div>
            <div class="partners-grid">
                <button class="partner-btn active" onclick="filterPartner(null)">
                    üè¢ All Partners
                    <span class="count" id="partner-count-all">{{ content|length }}</span>
                </button>
                {% for org in organizations %}
                <button class="partner-btn" data-organization-id="{{ org.id }}" onclick="filterPartner('{{ org.id }}')">
                    üè≠ {{ org.name }}
                    <span class="count" id="partner-count-{{ org.id }}">0</span>
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Content Type Filter -->
        <div class="content-type-section">
            <div class="content-type-header">
                <h3>üìÅ Content Type</h3>
            </div>
            <div class="content-type-grid">
                <button class="content-type-btn active" onclick="filterContentType(null)">
                    üìã All Types
                    <span class="count" id="type-count-all">{{ content|length }}</span>
                </button>
                <button class="content-type-btn" data-content-type="video" onclick="filterContentType('video')">
                    üé¨ Video
                    <span class="count" id="type-count-video">0</span>
                </button>
                <button class="content-type-btn" data-content-type="image" onclick="filterContentType('image')">
                    üñºÔ∏è Image
                    <span class="count" id="type-count-image">0</span>
                </button>
                <button class="content-type-btn" data-content-type="audio" onclick="filterContentType('audio')">
                    üéµ Audio
                    <span class="count" id="type-count-audio">0</span>
                </button>
            </div>
        </div>

        <!-- Folders -->
        <div class="folders-section">
            <div class="folders-header">
                <h3>üóÇÔ∏è Folders</h3>
                <button class="create-folder-btn" onclick="openCreateFolder()">
                    ‚ûï Create Folder
                </button>
            </div>
            <div class="folders-grid">
                <button class="folder-btn active" style="color: #64748b;" onclick="filterFolder(null)">
                    üìÇ All Content
                    <span class="count" id="count-all">{{ content|length }}</span>
                </button>
                {% for folder in folders %}
                <button class="folder-btn" style="color: {{ folder.color }};" onclick="filterFolder({{ folder.id }})">
                    {{ folder.icon }} {{ folder.name }}
                    <span class="count" id="count-{{ folder.id }}">0</span>
                    <button class="delete-folder" onclick="event.stopPropagation(); deleteFolder({{ folder.id }}, '{{ folder.name }}')">√ó</button>
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-section">
            <h3 id="contentHeader">All Content ({{ content|length }})</h3>

            {% if content %}
            <div class="content-grid" id="contentGrid">
                {% for item in content %}
                <div class="content-card" data-id="{{ item.id }}" data-folder="{{ item.folder_id or '' }}" data-networks='{{ item.network_ids|default([])|tojson|safe }}' data-organization="{{ item.organization_id or '' }}" data-content-type="{{ item.content_type or 'video' }}" data-status="{{ item.status or '' }}"
                     onclick="previewContent('{{ item.id }}', '{{ item.local_filename|default(item.filename) }}', '{{ item.title }}', {{ item.duration }}, {{ item.file_size }})">
                    <!-- Thumbnail with Status Badge -->
                    <div class="content-thumbnail">
                        {% if item.thumbnail_url %}
                        <img src="{{ item.thumbnail_url }}" alt="{{ item.title }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="no-thumbnail" style="display: none;">
                            {% if item.content_type == 'video' or not item.content_type %}üé¨{% elif item.content_type == 'image' %}üñºÔ∏è{% elif item.content_type == 'audio' %}üéµ{% else %}üìÑ{% endif %}
                            <span>Click to preview</span>
                        </div>
                        {% else %}
                        <div class="no-thumbnail">
                            {% if item.content_type == 'video' or not item.content_type %}üé¨{% elif item.content_type == 'image' %}üñºÔ∏è{% elif item.content_type == 'audio' %}üéµ{% else %}üìÑ{% endif %}
                            <span>Click to preview</span>
                        </div>
                        {% endif %}
                        {% if item.status %}
                        <span class="status-badge {{ item.status }}">{{ item.status|replace('_', ' ') }}</span>
                        {% endif %}
                    </div>
                    <div class="content-title">{{ item.title }}</div>
                    <div class="content-info">üìÑ {{ item.filename }}</div>
                    <div class="content-info">‚è±Ô∏è {{ item.duration }}s (auto-detected)</div>
                    <div class="content-info">üíæ {{ (item.file_size / 1024 / 1024)|round(1) }} MB</div>
                    <div class="content-meta-row">
                        {% if item.folder_name %}
                        <div class="folder-badge" style="background: {{ item.folder_color }}20; color: {{ item.folder_color }};">
                            {{ item.folder_icon }} {{ item.folder_name }}
                        </div>
                        {% endif %}
                        {% if item.organization_name %}
                        <div class="partner-badge">
                            üè¢ {{ item.organization_name }}
                        </div>
                        {% else %}
                        <div class="partner-badge no-partner">
                            üì§ Local Upload
                        </div>
                        {% endif %}
                    </div>
                    <span class="badge">ID: {{ item.id }}</span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üé¨</div>
                <h3>No content available</h3>
                <p>Content will appear here when added to the catalog.</p>
            </div>
            {% endif %}
        </div>
    </div>

</div>

<!-- Create Folder Modal -->
<div class="modal" id="createFolderModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Folder</h3>
            <button class="close-btn" onclick="closeCreateFolder()">&times;</button>
        </div>

        <form id="createFolderForm">
            <div class="form-group">
                <label>Folder Name</label>
                <input type="text" id="folderName" placeholder="e.g., Holiday Specials" required>
            </div>

            <div class="form-group">
                <label>Choose Icon</label>
                <div class="icon-picker">
                    <div class="icon-option selected" data-icon="üìÅ">üìÅ</div>
                    <div class="icon-option" data-icon="üéØ">üéØ</div>
                    <div class="icon-option" data-icon="üì¶">üì¶</div>
                    <div class="icon-option" data-icon="üéÑ">üéÑ</div>
                    <div class="icon-option" data-icon="üéâ">üéâ</div>
                    <div class="icon-option" data-icon="üé¨">üé¨</div>
                    <div class="icon-option" data-icon="‚≠ê">‚≠ê</div>
                    <div class="icon-option" data-icon="üíº">üíº</div>
                    <div class="icon-option" data-icon="üõçÔ∏è">üõçÔ∏è</div>
                    <div class="icon-option" data-icon="üé®">üé®</div>
                    <div class="icon-option" data-icon="üèÜ">üèÜ</div>
                    <div class="icon-option" data-icon="üíé">üíé</div>
                    <div class="icon-option" data-icon="üöÄ">üöÄ</div>
                    <div class="icon-option" data-icon="üé™">üé™</div>
                    <div class="icon-option" data-icon="üåü">üåü</div>
                    <div class="icon-option" data-icon="üî•">üî•</div>
                </div>
            </div>

            <div class="form-group">
                <label>Choose Color</label>
                <div class="color-picker">
                    <div class="color-option selected" style="background: #667eea;" data-color="#667eea"></div>
                    <div class="color-option" style="background: #10b981;" data-color="#10b981"></div>
                    <div class="color-option" style="background: #3b82f6;" data-color="#3b82f6"></div>
                    <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b"></div>
                    <div class="color-option" style="background: #ef4444;" data-color="#ef4444"></div>
                    <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                    <div class="color-option" style="background: #ec4899;" data-color="#ec4899"></div>
                    <div class="color-option" style="background: #14b8a6;" data-color="#14b8a6"></div>
                    <div class="color-option" style="background: #f97316;" data-color="#f97316"></div>
                    <div class="color-option" style="background: #06b6d4;" data-color="#06b6d4"></div>
                    <div class="color-option" style="background: #84cc16;" data-color="#84cc16"></div>
                    <div class="color-option" style="background: #64748b;" data-color="#64748b"></div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Create Folder</button>
        </form>
    </div>
</div>

<!-- Upload Modal -->
<div class="upload-modal" id="uploadModal">
    <div class="upload-modal-content">
        <div class="upload-modal-header">
            <h3>Upload Content</h3>
            <button class="upload-close-btn" onclick="closeUploadModal()">&times;</button>
        </div>
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="upload-form-group">
                <label>File *</label>
                <input type="file" name="file" id="uploadFile" required accept=".mp4,.mov,.avi,.jpg,.jpeg,.png,.gif,.webp">
            </div>
            <div class="upload-form-group">
                <label>Title</label>
                <input type="text" name="title" id="uploadTitle" placeholder="Content title (optional)">
            </div>
            <div class="upload-form-group">
                <label>Duration (seconds)</label>
                <input type="number" name="duration" id="uploadDuration" placeholder="Auto-detected for videos" min="1">
            </div>
            <button type="submit" class="upload-submit-btn">Upload Content</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let currentPreviewId = null;
    let currentFolder = null;
    let currentNetwork = null;
    let currentPartner = null;
    let currentContentType = null;
    let selectedIcon = 'üìÅ';
    let selectedColor = '#667eea';
    let isSyncing = false;

    // ==========================================================================
    // Content Sync Functions
    // ==========================================================================

    // Format timestamp for display
    function formatSyncTimestamp(isoString) {
        if (!isoString) {
            return 'Never';
        }
        const date = new Date(isoString);
        const now = new Date();
        const diff = now - date;

        // If less than a minute ago
        if (diff < 60000) {
            return 'Just now';
        }

        // If less than an hour ago
        if (diff < 3600000) {
            const minutes = Math.floor(diff / 60000);
            return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
        }

        // If less than a day ago
        if (diff < 86400000) {
            const hours = Math.floor(diff / 3600000);
            return `${hours} hour${hours > 1 ? 's' : ''} ago`;
        }

        // Otherwise show date and time
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // Load sync status on page load
    async function loadSyncStatus() {
        try {
            const response = await fetch('/api/v1/content/sync');
            if (response.ok) {
                const data = await response.json();

                // Update last sync time
                const lastSyncEl = document.getElementById('lastSyncTime');
                if (lastSyncEl) {
                    lastSyncEl.textContent = formatSyncTimestamp(data.last_synced);
                }

                // Update total synced count
                const totalSyncedEl = document.getElementById('totalSynced');
                if (totalSyncedEl) {
                    totalSyncedEl.textContent = data.total_synced || 0;
                }

                // Update catalog status
                const catalogStatusEl = document.getElementById('catalogStatus');
                const syncStatCatalogEl = document.getElementById('syncStatCatalog');
                if (catalogStatusEl && data.content_catalog) {
                    if (data.content_catalog.available) {
                        catalogStatusEl.textContent = 'Connected';
                        syncStatCatalogEl.classList.remove('error', 'warning');
                        syncStatCatalogEl.classList.add('success');
                    } else {
                        catalogStatusEl.textContent = 'Unavailable';
                        syncStatCatalogEl.classList.remove('success', 'warning');
                        syncStatCatalogEl.classList.add('error');
                    }
                }
            }
        } catch (error) {
            const catalogStatusEl = document.getElementById('catalogStatus');
            const syncStatCatalogEl = document.getElementById('syncStatCatalog');
            if (catalogStatusEl) {
                catalogStatusEl.textContent = 'Error';
                syncStatCatalogEl.classList.remove('success', 'warning');
                syncStatCatalogEl.classList.add('error');
            }
        }
    }

    // Sync content from Content Catalog
    async function syncContent() {
        if (isSyncing) return;

        const syncBtn = document.getElementById('syncBtn');
        const syncText = syncBtn.querySelector('.sync-text');

        // Update UI to show syncing state
        isSyncing = true;
        syncBtn.classList.add('syncing');
        syncBtn.disabled = true;
        syncText.textContent = 'Syncing...';

        try {
            const response = await fetch('/api/v1/content/sync', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (response.ok) {
                // Update last sync time
                const lastSyncEl = document.getElementById('lastSyncTime');
                if (lastSyncEl) {
                    lastSyncEl.textContent = formatSyncTimestamp(data.synced_at);
                }

                // Update total synced
                const totalSyncedEl = document.getElementById('totalSynced');
                if (totalSyncedEl) {
                    totalSyncedEl.textContent = data.synced_count || 0;
                }

                // Show success message
                alert(`‚úÖ Sync completed!\n\nSynced: ${data.synced_count} items\nCreated: ${data.created_count} new\nUpdated: ${data.updated_count} existing`);

                // Reload page to show new content
                if (data.created_count > 0 || data.updated_count > 0) {
                    location.reload();
                }
            } else {
                // Handle error
                alert(`‚ùå Sync failed: ${data.error || 'Unknown error'}\n\n${data.message || ''}`);
            }
        } catch (error) {
            alert(`‚ùå Sync failed: ${error.message}`);
        } finally {
            // Reset UI
            isSyncing = false;
            syncBtn.classList.remove('syncing');
            syncBtn.disabled = false;
            syncText.textContent = 'Sync Now';
        }
    }

    // Load sync status on page load

    // ==========================================================================
    // Filter Functions
    // ==========================================================================

    // Update network counts
    function updateNetworkCounts() {
        const cards = document.querySelectorAll('.content-card');
        const counts = {};
        let totalCount = 0;

        cards.forEach(card => {
            // Check if card is visible (not filtered by folder)
            if (card.style.display !== 'none') {
                totalCount++;
                const networkIds = card.dataset.networks;
                if (networkIds) {
                    try {
                        const networks = JSON.parse(networkIds);
                        networks.forEach(networkId => {
                            counts[networkId] = (counts[networkId] || 0) + 1;
                        });
                    } catch (e) {
                        // Single network ID as string
                        if (networkIds) {
                            counts[networkIds] = (counts[networkIds] || 0) + 1;
                        }
                    }
                }
            }
        });

        // Update network count badges
        document.querySelectorAll('.network-btn[data-network-id]').forEach(btn => {
            const networkId = btn.dataset.networkId;
            const countEl = document.getElementById(`network-count-${networkId}`);
            if (countEl) {
                countEl.textContent = counts[networkId] || 0;
            }
        });

        const allCountEl = document.getElementById(`network-count-all`);
        if (allCountEl) {
            allCountEl.textContent = totalCount;
        }
    }

    // Filter by network
    function filterNetwork(networkId) {
        currentNetwork = networkId;
        const buttons = document.querySelectorAll('.network-btn');

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.closest('.network-btn').classList.add('active');

        applyFilters();
    }

    updateNetworkCounts();

    // Update folder counts
    function updateFolderCounts() {
        const cards = document.querySelectorAll('.content-card');
        const counts = {};

        cards.forEach(card => {
            const folderId = card.dataset.folder;
            if (folderId) {
                counts[folderId] = (counts[folderId] || 0) + 1;
            }
        });

        Object.keys(counts).forEach(folderId => {
            const el = document.getElementById(`count-${folderId}`);
            if (el) el.textContent = counts[folderId];
        });

        document.getElementById('count-all').textContent = cards.length;
    }

    updateFolderCounts();

    // Update partner counts
    function updatePartnerCounts() {
        const cards = document.querySelectorAll('.content-card');
        const counts = {};
        let totalCount = 0;

        cards.forEach(card => {
            // Check if card is visible (not filtered by other filters)
            if (card.style.display !== 'none') {
                totalCount++;
                const orgId = card.dataset.organization;
                if (orgId) {
                    counts[orgId] = (counts[orgId] || 0) + 1;
                }
            }
        });

        // Update partner count badges
        document.querySelectorAll('.partner-btn[data-organization-id]').forEach(btn => {
            const orgId = btn.dataset.organizationId;
            const countEl = document.getElementById(`partner-count-${orgId}`);
            if (countEl) {
                countEl.textContent = counts[orgId] || 0;
            }
        });

        const allCountEl = document.getElementById('partner-count-all');
        if (allCountEl) {
            allCountEl.textContent = totalCount;
        }
    }

    updatePartnerCounts();

    // Update content type counts
    function updateContentTypeCounts() {
        const cards = document.querySelectorAll('.content-card');
        const counts = { video: 0, image: 0, audio: 0 };
        let totalCount = 0;

        cards.forEach(card => {
            // Check if card is visible (not filtered by other filters)
            if (card.style.display !== 'none') {
                totalCount++;
                const contentType = card.dataset.contentType || 'video';
                if (counts.hasOwnProperty(contentType)) {
                    counts[contentType]++;
                }
            }
        });

        // Update content type count badges
        document.getElementById('type-count-video').textContent = counts.video;
        document.getElementById('type-count-image').textContent = counts.image;
        document.getElementById('type-count-audio').textContent = counts.audio;

        const allCountEl = document.getElementById('type-count-all');
        if (allCountEl) {
            allCountEl.textContent = totalCount;
        }
    }

    updateContentTypeCounts();

    // Helper function to check if card matches all current filters
    function cardMatchesFilters(card) {
        // Check folder filter
        const folderMatch = currentFolder === null || card.dataset.folder == currentFolder;

        // Check network filter
        let networkMatch = false;
        if (currentNetwork === null) {
            networkMatch = true;
        } else {
            const networkIds = card.dataset.networks;
            if (networkIds) {
                try {
                    const networks = JSON.parse(networkIds);
                    networkMatch = networks.includes(currentNetwork);
                } catch (e) {
                    networkMatch = networkIds === currentNetwork;
                }
            }
        }

        // Check partner filter
        const partnerMatch = currentPartner === null || card.dataset.organization == currentPartner;

        // Check content type filter
        const contentTypeMatch = currentContentType === null || (card.dataset.contentType || 'video') === currentContentType;

        return folderMatch && networkMatch && partnerMatch && contentTypeMatch;
    }

    // Apply all filters and update counts
    function applyFilters() {
        const cards = document.querySelectorAll('.content-card');
        let visibleCount = 0;

        cards.forEach(card => {
            if (cardMatchesFilters(card)) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        document.getElementById('contentHeader').textContent = `Content (${visibleCount})`;
        updateNetworkCounts();
        updateFolderCounts();
        updatePartnerCounts();
        updateContentTypeCounts();
    }

    // Filter by partner (organization)
    function filterPartner(orgId) {
        currentPartner = orgId;
        const buttons = document.querySelectorAll('.partner-btn');

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.closest('.partner-btn').classList.add('active');

        applyFilters();
    }

    // Filter by content type
    function filterContentType(contentType) {
        currentContentType = contentType;
        const buttons = document.querySelectorAll('.content-type-btn');

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.closest('.content-type-btn').classList.add('active');

        applyFilters();
    }

    // Filter by folder
    function filterFolder(folderId) {
        currentFolder = folderId;
        const buttons = document.querySelectorAll('.folder-btn');

        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.closest('.folder-btn').classList.add('active');

        applyFilters();
    }

    // Create Folder Modal
    function openCreateFolder() {
        document.getElementById('createFolderModal').classList.add('active');
    }

    function closeCreateFolder() {
        document.getElementById('createFolderModal').classList.remove('active');
        document.getElementById('folderName').value = '';
    }

    // Icon selection
    document.querySelectorAll('.icon-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.icon-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedIcon = this.dataset.icon;
        });
    });

    // Color selection
    document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedColor = this.dataset.color;
        });
    });

    // Create folder form
    document.getElementById('createFolderForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('folderName').value;

        try {
            const response = await fetch('/api/folders', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: name,
                    icon: selectedIcon,
                    color: selectedColor
                })
            });

            if (response.ok) {
                alert('‚úÖ Folder created successfully!');
                location.reload();
            } else {
                const data = await response.json();
                alert('‚ùå Error: ' + data.error);
            }
        } catch (error) {
            alert('‚ùå Failed to create folder');
        }
    });

    // Delete folder
    async function deleteFolder(folderId, folderName) {
        if (!confirm(`Delete folder "${folderName}"? Content will not be deleted.`)) {
            return;
        }

        try {
            const response = await fetch(`/api/folders/${folderId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                location.reload();
            } else {
                alert('‚ùå Failed to delete folder');
            }
        } catch (error) {
            alert('‚ùå Error: ' + error.message);
        }
    }

    // Video preview
    function previewContent(id, filename, title, duration, fileSize) {
        document.querySelectorAll(".content-card").forEach(card => {
            card.classList.remove("active");
        });

        const card = document.querySelector('[data-id="' + id + '"]');
        if (card) card.classList.add("active");
        currentPreviewId = id;

        // Open video in new popup window
        const videoUrl = '/cms/uploads/' + filename;
        window.open(videoUrl, "VideoPreview", "width=900,height=600,resizable=yes");

        // Also update the info panel
        document.getElementById("playerTitle").textContent = title;
        document.getElementById("playerDuration").textContent = duration + "s";
        document.getElementById("playerSize").textContent = (fileSize / 1024 / 1024).toFixed(1) + " MB";
        document.getElementById("playerInfo").style.display = "block";
    }

    // ==========================================================================
    // UPLOAD FUNCTIONALITY
    // ==========================================================================
    
    function openUploadModal() {
        document.getElementById('uploadModal').classList.add('active');
    }
    
    function closeUploadModal() {
        document.getElementById('uploadModal').classList.remove('active');
        document.getElementById('uploadForm').reset();
    }
    
    document.getElementById('uploadModal').addEventListener('click', function(e) {
        if (e.target === this) closeUploadModal();
    });
    
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        const fileInput = document.getElementById('uploadFile');
        const titleInput = document.getElementById('uploadTitle');
        const durationInput = document.getElementById('uploadDuration');
        
        if (!fileInput.files[0]) {
            showToast(false, 'No File', 'Please select a file to upload');
            return;
        }
        
        formData.append('file', fileInput.files[0]);
        if (titleInput.value) formData.append('title', titleInput.value);
        if (durationInput.value) formData.append('duration', durationInput.value);
        
        try {
            const response = await fetch('/api/v1/content/upload', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (response.ok) {
                showToast(true, 'Upload Complete!', `"${result.title || fileInput.files[0].name}" uploaded`);
                closeUploadModal();
                setTimeout(() => location.reload(), 1500);
            } else {
                showToast(false, 'Upload Failed', result.error || 'Unknown error');
            }
        } catch (error) {
            console.error('Upload error:', error);
            showToast(false, 'Upload Error', 'Could not upload file');
        }
    });

</script>
{% endblock %}
