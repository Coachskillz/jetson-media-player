{% extends "base.html" %}

{% block title %}Device Manager - Skillz Media Screens CMS{% endblock %}

{% block extra_styles %}
/* Locations Section */
.locations-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 25px;
    margin: 20px 0;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.locations-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.locations-section h3 {
    font-size: 18px;
    color: #1e293b;
    font-weight: 700;
}

.create-location-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
}

.create-location-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.locations-grid {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.location-btn {
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
}

.location-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.location-btn.active {
    border-color: currentColor;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.location-btn .count {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.delete-location {
    background: #ef4444;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 2px 6px;
    font-size: 12px;
    cursor: pointer;
    margin-left: 8px;
    opacity: 0;
    transition: opacity 0.2s;
}

.location-btn:hover .delete-location {
    opacity: 1;
}

/* Pairing Box */
.pairing-box {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    margin: 20px 0;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.pairing-box h3 {
    font-size: 18px;
    color: #1e293b;
    margin-bottom: 20px;
    font-weight: 700;
}

.pairing-form {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 15px;
    align-items: end;
}

.form-group {
    margin: 0;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #475569;
    font-weight: 600;
    font-size: 14px;
}

.form-group input, .form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 14px;
    transition: all 0.2s;
}

.form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

#pairingCode {
    font-size: 18px;
    font-family: monospace;
    letter-spacing: 2px;
    text-align: center;
}

#pairingStatus {
    margin-top: 15px;
    padding: 12px;
    border-radius: 10px;
    display: none;
    font-size: 14px;
    font-weight: 500;
}

/* Devices Grid */
.devices-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    margin: 20px 0;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.devices-section h3 {
    font-size: 18px;
    color: #1e293b;
    margin-bottom: 20px;
    font-weight: 700;
}

.devices-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
}

.device-card {
    background: white;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s;
    border: 2px solid transparent;
}

.device-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.device-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e2e8f0;
}

.device-status {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
}

.device-status.online {
    background: #10b981;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
}

.device-status.online::before {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #10b981;
    animation: pulse 2s infinite;
}

.device-status.offline {
    background: #ef4444;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
}

.device-status.pending {
    background: #f59e0b;
    box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.2);
    animation: blink 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0; transform: scale(1.8); }
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

.device-info {
    flex: 1;
}

.device-name {
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 8px;
}

.device-name a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s;
}

.device-name a:hover {
    color: #667eea;
}

.device-settings-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: #667eea;
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    margin-top: 10px;
    padding: 8px 12px;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 8px;
    transition: all 0.2s;
}

.device-settings-link:hover {
    background: rgba(102, 126, 234, 0.2);
    transform: translateX(2px);
}

.device-meta {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-size: 13px;
    color: #64748b;
}

.device-meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.location-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    margin-top: 5px;
}

.badge-online {
    background: #d1fae5;
    color: #065f46;
}

.badge-offline {
    background: #fee2e2;
    color: #991b1b;
}

.badge-pending {
    background: #fef3c7;
    color: #92400e;
}

/* Connection Mode Badges */
.connection-mode-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-hub {
    background: #dbeafe;
    color: #1e40af;
}

.badge-direct {
    background: #d1fae5;
    color: #065f46;
}

.device-playlists {
    margin: 15px 0;
}

.section-title {
    font-size: 13px;
    font-weight: 600;
    color: #475569;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.playlist-item {
    background: #f8fafc;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 8px;
    border-left: 3px solid #667eea;
}

.playlist-name {
    font-weight: 600;
    color: #1e293b;
    font-size: 14px;
}

.playlist-trigger {
    font-size: 12px;
    color: #64748b;
    margin-top: 4px;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.modal-header h3 {
    font-size: 22px;
    color: #1e293b;
    font-weight: 700;
}

.close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #64748b;
    transition: color 0.2s;
}

.close-btn:hover {
    color: #1e293b;
}

/* Icon & Color Pickers */
.icon-picker {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 8px;
    margin: 15px 0;
}

.icon-option {
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    text-align: center;
    font-size: 24px;
    transition: all 0.2s;
}

.icon-option:hover {
    border-color: #667eea;
    transform: scale(1.1);
}

.icon-option.selected {
    border-color: #667eea;
    background: #eef2ff;
}

.color-picker {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
    margin: 15px 0;
}

.color-option {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.selected {
    border-color: #1e293b;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn-assign {
    background: #10b981;
    width: 100%;
    margin-top: 15px;
}

.btn-assign:hover {
    background: #059669;
}

/* Network Section */
.network-section {
    margin-bottom: 24px;
}

.network-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

.network-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.network-info h3 {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 4px;
}

.network-info p {
    font-size: 13px;
    opacity: 0.9;
}

.network-stats {
    display: flex;
    gap: 20px;
    text-align: center;
}

.network-stat {
    background: rgba(255, 255, 255, 0.2);
    padding: 10px 16px;
    border-radius: 10px;
}

.network-stat-value {
    font-size: 24px;
    font-weight: 800;
}

.network-stat-label {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.9;
}

/* Screens Grid */
.screens-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    padding: 20px;
}

.screen-card {
    background: #f8fafc;
    border-radius: 12px;
    padding: 16px;
    border: 1px solid #e2e8f0;
    transition: all 0.2s;
}

.screen-card:hover {
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.screen-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 12px;
}

.screen-name {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 4px;
}

.screen-id {
    font-size: 12px;
    color: #64748b;
    font-family: monospace;
}

.screen-status {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.screen-status.active {
    background: #d1fae5;
    color: #065f46;
}

.screen-status.offline {
    background: #fee2e2;
    color: #991b1b;
}

.screen-status.pending {
    background: #fef3c7;
    color: #92400e;
}

.screen-status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
}

.screen-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e2e8f0;
}

.screen-detail {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.screen-detail-label {
    font-size: 11px;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.screen-detail-value {
    font-size: 13px;
    color: #1e293b;
    font-weight: 500;
}

.screen-actions {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e2e8f0;
}

.screen-actions a {
    font-size: 13px;
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.screen-actions a:hover {
    text-decoration: underline;
}

/* Empty State */
.empty-network {
    padding: 40px;
    text-align: center;
    color: #64748b;
}

.empty-network-icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.5;
}

.empty-network h4 {
    font-size: 16px;
    color: #1e293b;
    margin-bottom: 8px;
}

.empty-network p {
    font-size: 14px;
}

/* No Networks */
.no-networks {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 60px 40px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.no-networks-icon {
    font-size: 64px;
    margin-bottom: 20px;
}

.no-networks h3 {
    font-size: 20px;
    color: #1e293b;
    margin-bottom: 10px;
}

.no-networks p {
    color: #64748b;
    margin-bottom: 20px;
}
{% endblock %}

{% block content %}
{% if filtered_hub %}
<!-- Hub Filtered View -->
<div style="margin: 20px 0 15px 0; display: flex; align-items: center; gap: 16px;">
    <a href="/devices" style="color: white; text-decoration: none; font-size: 14px; opacity: 0.8;">&larr; All Screens</a>
    <h2 style="color: white; font-size: 24px; font-weight: 700; margin: 0;">{{ filtered_hub.code }} - {{ filtered_hub.name }}</h2>
</div>

<div class="network-card">
    <div class="network-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="network-info">
            <h3>Hub: {{ filtered_hub.name }}</h3>
            <p>Code: {{ filtered_hub.code }} {% if filtered_hub.network %} | Network: {{ filtered_hub.network.name }}{% endif %}</p>
        </div>
        <div class="network-stats">
            <div class="network-stat">
                <div class="network-stat-value">{{ hub_screens|length }}</div>
                <div class="network-stat-label">Screens</div>
            </div>
            <div class="network-stat">
                <div class="network-stat-value">{{ hub_screens|selectattr('status', 'equalto', 'active')|list|length }}</div>
                <div class="network-stat-label">Online</div>
            </div>
        </div>
    </div>

    {% if hub_screens %}
    <div class="screens-grid">
        {% for screen in hub_screens %}
        <div class="screen-card">
            <div class="screen-header">
                <div>
                    <div class="screen-name">{{ screen.name }}</div>
                    <div class="screen-id">{{ screen.device_id }}</div>
                </div>
                <div class="screen-status {{ screen.status }}">
                    <span class="screen-status-dot"></span>
                    {{ screen.status }}
                </div>
            </div>

            <div class="screen-details">
                <div class="screen-detail">
                    <span class="screen-detail-label">Layout</span>
                    <span class="screen-detail-value">{{ screen.layout_name }}</span>
                </div>
                <div class="screen-detail">
                    <span class="screen-detail-label">Playing</span>
                    <span class="screen-detail-value">{{ screen.current_playlist }}</span>
                </div>
            </div>

            <div class="screen-actions">
                <a href="/devices/{{ screen.device_id }}">Manage Screen &rarr;</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-network">
        <div class="empty-network-icon">&#128247;</div>
        <h4>No screens connected to this hub</h4>
        <p>Pair screens to this hub from the Dashboard.</p>
    </div>
    {% endif %}
</div>

{% else %}
<!-- Normal View -->
<h2 style="margin: 20px 0 15px 0; color: white; font-size: 24px; font-weight: 700;">Screens</h2>

<!-- Locations -->
<div class="locations-section">
    <div class="locations-header">
        <h3>Locations</h3>
        <button class="create-location-btn" onclick="openCreateLocation()">
            + Create Location
        </button>
    </div>
    <div class="locations-grid">
        {% for location in locations %}
        <button class="location-btn" style="color: {{ location.color }};" onclick="filterByLocation('{{ location.id }}')">
            {{ location.icon }} {{ location.name }}
            <span class="count" id="count-{{ location.id }}">0</span>
            <button class="delete-location" onclick="event.stopPropagation(); deleteLocation('{{ location.id }}', '{{ location.name }}')">√ó</button>
        </button>
        {% endfor %}
        {% if not locations %}
        <p style="color: #64748b; font-size: 14px;">No locations created yet. Create a location to organize your screens.</p>
        {% endif %}
    </div>
</div>

<!-- Networks and Screens Catalog -->
<div class="network-section">
    {% if networks %}
        {% for network in networks %}
        <div class="network-card">
            <div class="network-header">
                <div class="network-info">
                    <h3>{{ network.name }}</h3>
                    <p>{{ network.description or 'No description' }}</p>
                </div>
                <div class="network-stats">
                    <div class="network-stat">
                        <div class="network-stat-value">{{ network.screen_count }}</div>
                        <div class="network-stat-label">Screens</div>
                    </div>
                    <div class="network-stat">
                        <div class="network-stat-value">{{ network.online_count }}</div>
                        <div class="network-stat-label">Online</div>
                    </div>
                </div>
            </div>

            {% if network.screens %}
            <div class="screens-grid">
                {% for screen in network.screens %}
                <div class="screen-card">
                    <div class="screen-header">
                        <div>
                            <div class="screen-name">{{ screen.name }}</div>
                            <div class="screen-id">{{ screen.device_id }}</div>
                        </div>
                        <div class="screen-status {{ screen.status }}">
                            <span class="screen-status-dot"></span>
                            {{ screen.status }}
                        </div>
                    </div>

                    <div class="screen-details">
                        <div class="screen-detail">
                            <span class="screen-detail-label">Layout</span>
                            <span class="screen-detail-value">{{ screen.layout_name }}</span>
                        </div>
                        <div class="screen-detail">
                            <span class="screen-detail-label">Playing</span>
                            <span class="screen-detail-value">{{ screen.current_playlist }}</span>
                        </div>
                    </div>

                    <div class="screen-actions">
                        <a href="/devices/{{ screen.device_id }}">Manage Screen &rarr;</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-network">
                <div class="empty-network-icon">&#128247;</div>
                <h4>No screens in this network</h4>
                <p>Add screens to this network to see them here.</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
    <div class="no-networks">
        <div class="no-networks-icon">&#127760;</div>
        <h3>No Networks Configured</h3>
        <p>Create a network and add screens to get started.</p>
        <a href="/" class="btn btn-primary">Go to Dashboard</a>
    </div>
    {% endif %}
</div>

<!-- Individual/Unassigned Devices -->
{% if unassigned_devices %}
<div class="network-card" style="margin-top: 24px;">
    <div class="network-header" style="background: linear-gradient(135deg, #64748b 0%, #475569 100%);">
        <div class="network-info">
            <h3>Individual Devices</h3>
            <p>Screens not assigned to a network</p>
        </div>
        <div class="network-stats">
            <div class="network-stat">
                <div class="network-stat-value">{{ unassigned_devices|length }}</div>
                <div class="network-stat-label">Screens</div>
            </div>
        </div>
    </div>
    <div class="screens-grid">
        {% for device in unassigned_devices %}
        <div class="screen-card">
            <div class="screen-header">
                <div>
                    <div class="screen-name">{{ device.name or device.device_id }}</div>
                    <div class="screen-id">{{ device.device_id }}</div>
                </div>
                <div class="screen-status {{ device.status }}">
                    <span class="screen-status-dot"></span>
                    {{ device.status }}
                </div>
            </div>
            <div class="screen-details">
                <div class="screen-detail">
                    <span class="screen-detail-label">Mode</span>
                    <span class="screen-detail-value">{{ device.mode or 'direct' }}</span>
                </div>
                <div class="screen-detail">
                    <span class="screen-detail-label">Status</span>
                    <span class="screen-detail-value">{{ device.status }}</span>
                </div>
            </div>
            <div class="screen-actions">
                <a href="/devices/{{ device.device_id }}">Manage Screen &rarr;</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Create Location Modal -->
<div class="modal" id="createLocationModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Location</h3>
            <button class="close-btn" onclick="closeCreateLocation()">&times;</button>
        </div>

        <form id="createLocationForm">
            <div class="form-group">
                <label>Location Name</label>
                <input type="text" id="locationName" placeholder="e.g., Store A, Headquarters" required>
            </div>

            <div class="form-group">
                <label>Address (Optional)</label>
                <input type="text" id="locationAddress" placeholder="123 Main St, City, State">
            </div>

            <div class="form-group">
                <label>Choose Icon</label>
                <div class="icon-picker">
                    <div class="icon-option selected" data-icon="üìç">üìç</div>
                    <div class="icon-option" data-icon="üè¢">üè¢</div>
                    <div class="icon-option" data-icon="üè™">üè™</div>
                    <div class="icon-option" data-icon="üè¨">üè¨</div>
                    <div class="icon-option" data-icon="üè≠">üè≠</div>
                    <div class="icon-option" data-icon="üèõÔ∏è">üèõÔ∏è</div>
                    <div class="icon-option" data-icon="üèüÔ∏è">üèüÔ∏è</div>
                    <div class="icon-option" data-icon="üè®">üè®</div>
                    <div class="icon-option" data-icon="üè¶">üè¶</div>
                    <div class="icon-option" data-icon="üè•">üè•</div>
                    <div class="icon-option" data-icon="‚õ™">‚õ™</div>
                    <div class="icon-option" data-icon="üåÜ">üåÜ</div>
                    <div class="icon-option" data-icon="üó∫Ô∏è">üó∫Ô∏è</div>
                    <div class="icon-option" data-icon="üåç">üåç</div>
                    <div class="icon-option" data-icon="üè†">üè†</div>
                    <div class="icon-option" data-icon="üè°">üè°</div>
                </div>
            </div>

            <div class="form-group">
                <label>Choose Color</label>
                <div class="color-picker">
                    <div class="color-option selected" style="background: #667eea;" data-color="#667eea"></div>
                    <div class="color-option" style="background: #10b981;" data-color="#10b981"></div>
                    <div class="color-option" style="background: #3b82f6;" data-color="#3b82f6"></div>
                    <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b"></div>
                    <div class="color-option" style="background: #ef4444;" data-color="#ef4444"></div>
                    <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                    <div class="color-option" style="background: #ec4899;" data-color="#ec4899"></div>
                    <div class="color-option" style="background: #14b8a6;" data-color="#14b8a6"></div>
                    <div class="color-option" style="background: #f97316;" data-color="#f97316"></div>
                    <div class="color-option" style="background: #06b6d4;" data-color="#06b6d4"></div>
                    <div class="color-option" style="background: #84cc16;" data-color="#84cc16"></div>
                    <div class="color-option" style="background: #64748b;" data-color="#64748b"></div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Create Location</button>
        </form>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
    let selectedLocationIcon = 'üìç';
    let selectedLocationColor = '#667eea';

    // Create Location Modal
    function openCreateLocation() {
        document.getElementById('createLocationModal').classList.add('active');
    }

    function closeCreateLocation() {
        document.getElementById('createLocationModal').classList.remove('active');
    }

    // Icon & Color selection for locations
    document.querySelectorAll('#createLocationModal .icon-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('#createLocationModal .icon-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedLocationIcon = this.dataset.icon;
        });
    });

    document.querySelectorAll('#createLocationModal .color-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('#createLocationModal .color-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            selectedLocationColor = this.dataset.color;
        });
    });

    // Create location form
    document.getElementById('createLocationForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('locationName').value;
        const address = document.getElementById('locationAddress').value;

        try {
            const response = await fetch('/api/locations', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: name,
                    address: address,
                    icon: selectedLocationIcon,
                    color: selectedLocationColor
                })
            });

            if (response.ok) {
                location.reload();
            } else {
                const data = await response.json();
                alert('Error: ' + data.error);
            }
        } catch (error) {
            alert('Failed to create location');
        }
    });

    // Delete location
    async function deleteLocation(locationId, locationName) {
        if (!confirm(`Delete location "${locationName}"? Screens will not be deleted.`)) {
            return;
        }

        try {
            const response = await fetch(`/api/locations/${locationId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to delete location');
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }

    // Filter screens by location (future functionality)
    function filterByLocation(locationId) {
        // TODO: Filter network cards/screens by location
        console.log('Filter by location:', locationId);
    }
</script>
{% endblock %}
