{% extends "base.html" %}

{% block title %}Layout Designer - {{ layout.name }} - Skillz Media Screens CMS{% endblock %}

{% block extra_styles %}
/* Layout Designer - Full Screen Mode */
body {
    background: #0a0a10;
    min-height: 100vh;
    overflow: hidden;
}

.header {
    background: rgba(10, 10, 16, 0.95);
    border-bottom: 1px solid #333;
    padding: 10px 20px;
}

.header .container {
    max-width: none;
    padding: 0;
}

.header h1 {
    font-size: 20px;
    margin-bottom: 0;
}

.header .nav {
    margin-top: 10px;
}

.container {
    max-width: none;
    padding: 0;
}

/* Hide footer in designer mode */
.footer {
    display: none;
}

/* Designer Layout - Photoshop Style */
.designer-wrapper {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 80px);
    background: #1a1a1f;
}

/* Top Menu Bar */
.designer-menubar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: #2d2d35;
    border-bottom: 1px solid #3d3d45;
    flex-shrink: 0;
    height: 44px;
}

.menubar-section {
    display: flex;
    align-items: center;
    gap: 8px;
}

.menubar-divider {
    width: 1px;
    height: 24px;
    background: #3d3d45;
    margin: 0 8px;
}

.menubar-spacer {
    flex-grow: 1;
}

/* Main Content Area (toolbar + canvas + panels) */
.designer-content {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}

/* Left Vertical Toolbar - Photoshop Style */
.toolbar-vertical {
    width: 48px;
    background: #2d2d35;
    border-right: 1px solid #3d3d45;
    display: flex;
    flex-direction: column;
    padding: 8px 4px;
    gap: 4px;
    flex-shrink: 0;
}

.toolbar-vertical .tool-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: transparent;
    border: none;
    color: #888;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
}

.toolbar-vertical .tool-btn:hover {
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
}

.toolbar-vertical .tool-btn.active {
    background: #00D4AA;
    color: #1a1a1f;
}

.toolbar-vertical .tool-btn .shortcut {
    position: absolute;
    bottom: 2px;
    right: 4px;
    font-size: 9px;
    color: #666;
}

.toolbar-vertical .tool-btn.active .shortcut {
    color: #1a1a1f;
}

.tool-divider {
    height: 1px;
    background: #3d3d45;
    margin: 8px 4px;
}

/* Horizontal Toolbar (legacy support) */
.designer-toolbar {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px 20px;
    background: rgba(10, 10, 16, 0.95);
    border-bottom: 1px solid #333;
    flex-shrink: 0;
}

.toolbar-group {
    display: flex;
    align-items: center;
    gap: 8px;
    padding-right: 16px;
    border-right: 1px solid #333;
}

.toolbar-group:last-child {
    border-right: none;
}

.toolbar-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    color: #888;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
}

.toolbar-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border-color: #444;
}

.toolbar-btn.active {
    background: linear-gradient(135deg, #00D4AA 0%, #00B090 100%);
    color: #050508;
    border-color: #00D4AA;
}

.toolbar-btn-text {
    width: auto;
    padding: 0 16px;
    font-size: 14px;
    font-weight: 500;
    gap: 8px;
}

.toolbar-label {
    color: #888;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-right: 8px;
}

.toolbar-select {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    border-radius: 8px;
    color: #fff;
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    min-width: 100px;
}

.toolbar-select:hover {
    border-color: #444;
}

.toolbar-select:focus {
    outline: none;
    border-color: #00D4AA;
}

.toolbar-spacer {
    flex-grow: 1;
}

.btn-save {
    background: linear-gradient(135deg, #00D4AA 0%, #00B090 100%);
    color: #050508;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(0, 212, 170, 0.3);
}

.btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 212, 170, 0.4);
}

/* Main Designer Area */
.designer-main {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}

/* Left Panel - Layer List */
.panel-left {
    width: 280px;
    background: rgba(10, 10, 16, 0.95);
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
}

.panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    border-bottom: 1px solid #333;
}

.panel-title {
    color: #fff;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.panel-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: rgba(0, 212, 170, 0.1);
    border: 1px solid rgba(0, 212, 170, 0.3);
    color: #00D4AA;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s;
}

.panel-action:hover {
    background: rgba(0, 212, 170, 0.2);
    border-color: #00D4AA;
}

.panel-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 8px;
}

/* Layer List */
.layer-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.layer-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid transparent;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
}

.layer-item:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: #333;
}

.layer-item.selected {
    background: rgba(0, 212, 170, 0.1);
    border-color: #00D4AA;
}

.layer-visibility {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    color: #666;
    font-size: 14px;
    cursor: pointer;
    transition: color 0.2s;
}

.layer-visibility:hover {
    color: #888;
}

.layer-visibility.visible {
    color: #00D4AA;
}

.layer-preview {
    width: 40px;
    height: 30px;
    background: #1a1a24;
    border: 1px solid #333;
    border-radius: 4px;
    flex-shrink: 0;
}

.layer-info {
    flex-grow: 1;
    min-width: 0;
}

.layer-name {
    color: #fff;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.layer-dims {
    color: #666;
    font-size: 11px;
    margin-top: 2px;
}

.layer-lock {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    color: #444;
    font-size: 12px;
    cursor: pointer;
    transition: color 0.2s;
}

.layer-lock:hover {
    color: #666;
}

.layer-lock.locked {
    color: #ff6b6b;
}

/* Empty Layer State */
.layers-empty {
    text-align: center;
    padding: 40px 20px;
    color: #666;
}

.layers-empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.layers-empty-text {
    font-size: 14px;
    line-height: 1.6;
}

/* Canvas Container */
.canvas-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: auto;
    background: #1a1a2e;
    position: relative;
    padding: 40px;
}

/* Screen Label */
.screen-label {
    color: #667eea;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Checkerboard Pattern for Transparency */
.canvas-wrapper {
    position: relative;
    box-shadow: 0 0 0 3px #667eea, 0 20px 60px rgba(0, 0, 0, 0.5);
    border-radius: 2px;
}

/* Screen base layer visual */
.canvas-checkerboard {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000000;
    pointer-events: none;
}

/* Corner markers showing screen bounds */
.canvas-wrapper::before {
    content: '';
    position: absolute;
    top: -8px;
    left: -8px;
    right: -8px;
    bottom: -8px;
    border: 1px dashed rgba(102, 126, 234, 0.3);
    border-radius: 4px;
    pointer-events: none;
}

/* Dimension labels on canvas */
.canvas-dimension-label {
    position: absolute;
    font-size: 10px;
    color: #667eea;
    font-weight: 600;
    background: rgba(26, 26, 46, 0.9);
    padding: 2px 6px;
    border-radius: 3px;
}

.canvas-dimension-label.width {
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
}

.canvas-dimension-label.height {
    right: -40px;
    top: 50%;
    transform: translateY(-50%) rotate(90deg);
}

#layout-canvas {
    position: relative;
    z-index: 1;
}

/* Fabric.js creates two canvases - ensure both work */
.canvas-container canvas {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
}

/* Upper canvas handles interactions */
.upper-canvas {
    z-index: 10 !important;
    cursor: default;
}

/* Lower canvas renders objects */
.lower-canvas {
    z-index: 5 !important;
}

/* Right Panel - Properties */
.panel-right {
    width: 320px;
    background: rgba(10, 10, 16, 0.95);
    border-left: 1px solid #333;
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
}

/* Properties Panel Sections */
.properties-section {
    border-bottom: 1px solid #333;
    padding: 16px;
}

.properties-section:last-child {
    border-bottom: none;
}

.section-title {
    color: #888;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 12px;
}

/* Property Row */
.property-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
}

.property-row:last-child {
    margin-bottom: 0;
}

.property-label {
    color: #888;
    font-size: 12px;
    font-weight: 500;
    min-width: 50px;
}

.property-input {
    flex-grow: 1;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    border-radius: 6px;
    color: #fff;
    padding: 8px 10px;
    font-size: 13px;
    font-family: 'Monaco', 'Menlo', monospace;
}

.property-input:hover {
    border-color: #444;
}

.property-input:focus {
    outline: none;
    border-color: #00D4AA;
    background: rgba(255, 255, 255, 0.08);
}

.property-input-sm {
    width: 70px;
    flex-grow: 0;
}

.property-group {
    display: flex;
    gap: 8px;
}

/* Color Picker Wrapper */
.color-picker-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
}

.color-preview {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    border: 1px solid #333;
    cursor: pointer;
    transition: border-color 0.2s;
}

.color-preview:hover {
    border-color: #444;
}

/* Slider */
.property-slider {
    flex-grow: 1;
    -webkit-appearance: none;
    height: 6px;
    background: #333;
    border-radius: 3px;
    outline: none;
}

.property-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: #00D4AA;
    border-radius: 50%;
    cursor: pointer;
}

.property-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: #00D4AA;
    border-radius: 50%;
    cursor: pointer;
    border: none;
}

/* Select Dropdown */
.property-select {
    flex-grow: 1;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    border-radius: 6px;
    color: #fff;
    padding: 8px 10px;
    font-size: 13px;
    cursor: pointer;
}

.property-select:hover {
    border-color: #444;
}

.property-select:focus {
    outline: none;
    border-color: #00D4AA;
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #333;
    transition: .3s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: #888;
    transition: .3s;
    border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
    background-color: #00D4AA;
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(20px);
    background-color: #fff;
}

.property-hint {
    font-size: 11px;
    color: #666;
    margin-left: 8px;
}

/* Content Assignment */
.content-mode-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 12px;
}

.content-mode-tab {
    flex: 1;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    border-radius: 6px;
    color: #888;
    font-size: 12px;
    font-weight: 500;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.content-mode-tab:hover {
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
}

.content-mode-tab.active {
    background: rgba(0, 212, 170, 0.15);
    border-color: #00D4AA;
    color: #00D4AA;
}

.content-preview {
    background: #1a1a24;
    border: 1px dashed #333;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    color: #666;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
}

.content-preview:hover {
    border-color: #00D4AA;
    background: rgba(0, 212, 170, 0.05);
}

.content-preview-icon {
    font-size: 32px;
    margin-bottom: 8px;
}

/* Textarea styling */
textarea.property-input {
    resize: vertical;
    min-height: 60px;
    font-family: inherit;
}

/* Widget config sections */
.widget-config {
    transition: opacity 0.2s;
}

/* Button Styles in Panels */
.panel-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid #333;
    border-radius: 6px;
    color: #888;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
}

.panel-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    border-color: #444;
}

.panel-btn-group {
    display: flex;
    gap: 4px;
}

.panel-btn-icon {
    flex: 1;
    justify-content: center;
}

/* No Selection State */
.no-selection {
    padding: 40px 20px;
    text-align: center;
    color: #666;
}

.no-selection-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.no-selection-text {
    font-size: 14px;
    line-height: 1.6;
}

/* Canvas Info Bar */
.canvas-info {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 8px 16px;
    background: rgba(10, 10, 16, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid #333;
    border-radius: 8px;
    color: #888;
    font-size: 12px;
    z-index: 10;
}

.canvas-info-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.canvas-info-label {
    color: #666;
}

.canvas-info-value {
    color: #00D4AA;
    font-family: 'Monaco', 'Menlo', monospace;
}

/* Scrollbar Styling */
.panel-content::-webkit-scrollbar {
    width: 8px;
}

.panel-content::-webkit-scrollbar-track {
    background: transparent;
}

.panel-content::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}

.panel-content::-webkit-scrollbar-thumb:hover {
    background: #444;
}

/* Responsive - Hide Panels on Small Screens */
@media (max-width: 1200px) {
    .panel-right {
        width: 280px;
    }
}

@media (max-width: 900px) {
    .panel-left, .panel-right {
        display: none;
    }
}
{% endblock %}

{% block content %}
<div class="designer-wrapper">
    <!-- Top Menu Bar - Photoshop Style -->
    <div class="designer-menubar">
        <div class="menubar-section">
            <a href="/layouts" class="toolbar-btn" title="Back to Layouts" style="width: auto; padding: 0 12px; font-size: 14px;">
                <span>&#8592;</span> Layouts
            </a>
        </div>

        <div class="menubar-divider"></div>

        <div class="menubar-section">
            <span style="color: #fff; font-weight: 500;">{{ layout.name }}</span>
        </div>

        <div class="menubar-divider"></div>

        <div class="menubar-section">
            <span class="toolbar-label">Canvas</span>
            <select class="toolbar-select" id="canvas-preset" style="min-width: 180px;">
                <option value="1920x1080" {% if layout.canvas_width == 1920 and layout.canvas_height == 1080 %}selected{% endif %}>1920 x 1080 (16:9 HD)</option>
                <option value="1920x725" {% if layout.canvas_width == 1920 and layout.canvas_height == 725 %}selected{% endif %}>1920 x 725 (2.65:1 Ultra-wide)</option>
                <option value="725x1920" {% if layout.canvas_width == 725 and layout.canvas_height == 1920 %}selected{% endif %}>725 x 1920 (2.65:1 Portrait)</option>
                <option value="3840x2160" {% if layout.canvas_width == 3840 and layout.canvas_height == 2160 %}selected{% endif %}>3840 x 2160 (4K)</option>
                <option value="1080x1920" {% if layout.canvas_width == 1080 and layout.canvas_height == 1920 %}selected{% endif %}>1080 x 1920 (9:16 Portrait)</option>
                <option value="1080x1080" {% if layout.canvas_width == 1080 and layout.canvas_height == 1080 %}selected{% endif %}>1080 x 1080 (Square)</option>
                <option value="custom">Custom...</option>
            </select>
            <span id="canvas-dimensions" style="color: #666; font-size: 12px; margin-left: 8px;">
                {{ layout.canvas_width }} x {{ layout.canvas_height }}
            </span>
        </div>

        <div class="menubar-divider"></div>

        <div class="menubar-section">
            <span class="toolbar-label">Zoom</span>
            <select class="toolbar-select" id="zoom-level" style="min-width: 80px;">
                <option value="0.25">25%</option>
                <option value="0.50">50%</option>
                <option value="0.75">75%</option>
                <option value="1.00" selected>100%</option>
                <option value="1.50">150%</option>
                <option value="2.00">200%</option>
            </select>
            <button class="toolbar-btn" id="zoom-fit" title="Fit to Window" style="width: 32px; height: 32px;">
                <span>&#8596;</span>
            </button>
        </div>

        <div class="menubar-spacer"></div>

        <div class="menubar-section">
            <button class="toolbar-btn toolbar-btn-text btn-save" id="save-layout" style="height: 32px;">
                <span>&#128190;</span> Save
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="designer-content">
        <!-- Left Vertical Toolbar -->
        <div class="toolbar-vertical">
            <button class="tool-btn active" id="tool-select" title="Select (V)">
                <span>&#9654;</span>
                <span class="shortcut">V</span>
            </button>
            <button class="tool-btn" id="tool-draw" title="Draw Layer (D)">
                <span>&#9633;</span>
                <span class="shortcut">D</span>
            </button>

            <div class="tool-divider"></div>

            <button class="tool-btn" id="zoom-in" title="Zoom In (+)">
                <span>&#43;</span>
            </button>
            <button class="tool-btn" id="zoom-out" title="Zoom Out (-)">
                <span>&#8722;</span>
            </button>

            <div class="tool-divider"></div>

            <button class="tool-btn" id="toggle-grid" title="Toggle Grid (G)">
                <span>&#9638;</span>
                <span class="shortcut">G</span>
            </button>
            <button class="tool-btn" id="toggle-snap" title="Snap to Grid (S)">
                <span>&#9883;</span>
                <span class="shortcut">S</span>
            </button>

            <div class="tool-divider"></div>

            <button class="tool-btn" id="layer-front" title="Bring to Front">
                <span>&#8593;</span>
            </button>
            <button class="tool-btn" id="layer-back" title="Send to Back">
                <span>&#8595;</span>
            </button>
            <button class="tool-btn" id="layer-delete" title="Delete Layer (Del)" style="color: #ff6b6b;">
                <span>&#128465;</span>
            </button>
        </div>

        <!-- Main Designer Area -->
        <div class="designer-main" style="flex-grow: 1;">
        <!-- Left Panel - Layers -->
        <div class="panel-left">
            <div class="panel-header">
                <span class="panel-title">Layers</span>
                <button class="panel-action" id="add-layer" title="Add Layer">
                    <span>&#43;</span>
                </button>
            </div>
            <div class="panel-content">
                <div class="layer-list" id="layer-list">
                    <!-- Layer items will be rendered by JavaScript -->
                </div>

                <!-- Empty state placeholder -->
                <div class="layers-empty" id="layers-empty">
                    <div class="layers-empty-icon">&#128195;</div>
                    <div class="layers-empty-text">
                        No layers yet.<br>
                        Click <strong>Draw</strong> to create a layer or use the <strong>+</strong> button above.
                    </div>
                </div>
            </div>
        </div>

        <!-- Canvas Container -->
        <div class="canvas-container" id="canvas-container">
            <!-- Screen Label -->
            <div class="screen-label" id="screen-label">
                Screen: {{ layout.canvas_width }} x {{ layout.canvas_height }}
            </div>

            <div class="canvas-wrapper" id="canvas-wrapper">
                <!-- Base screen layer (black background) -->
                <div class="canvas-checkerboard" id="canvas-checkerboard"
                     style="width: {{ layout.canvas_width }}px; height: {{ layout.canvas_height }}px;"></div>
                <canvas id="layout-canvas"></canvas>

                <!-- Dimension labels -->
                <div class="canvas-dimension-label width" id="dim-width">{{ layout.canvas_width }}px</div>
                <div class="canvas-dimension-label height" id="dim-height">{{ layout.canvas_height }}px</div>
            </div>

            <!-- Canvas Info Bar -->
            <div class="canvas-info">
                <div class="canvas-info-item">
                    <span class="canvas-info-label">Position:</span>
                    <span class="canvas-info-value" id="info-position">--, --</span>
                </div>
                <div class="canvas-info-item">
                    <span class="canvas-info-label">Size:</span>
                    <span class="canvas-info-value" id="info-size">-- x --</span>
                </div>
                <div class="canvas-info-item">
                    <span class="canvas-info-label">Zoom:</span>
                    <span class="canvas-info-value" id="info-zoom">100%</span>
                </div>
            </div>
        </div>

        <!-- Right Panel - Properties -->
        <div class="panel-right">
            <div class="panel-header">
                <span class="panel-title">Properties</span>
            </div>
            <div class="panel-content" id="properties-panel">
                <!-- No selection state -->
                <div class="no-selection" id="no-selection">
                    <div class="no-selection-icon">&#128204;</div>
                    <div class="no-selection-text">
                        Select a layer to edit its properties.
                    </div>
                </div>

                <!-- Layer Properties (hidden by default) -->
                <div id="layer-properties" style="display: none;">
                    <!-- Position & Size (Percentage-based like OptiSigns) -->
                    <div class="properties-section">
                        <div class="section-title">Position & Size</div>
                        <div class="property-row">
                            <span class="property-label">Left(%)</span>
                            <input type="number" class="property-input property-input-sm" id="prop-left-pct" value="0" min="0" max="100" step="0.1">
                            <span class="property-label">Top(%)</span>
                            <input type="number" class="property-input property-input-sm" id="prop-top-pct" value="0" min="0" max="100" step="0.1">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Width(%)</span>
                            <input type="number" class="property-input property-input-sm" id="prop-width-pct" value="100" min="1" max="100" step="0.1">
                            <span class="property-label">Height(%)</span>
                            <input type="number" class="property-input property-input-sm" id="prop-height-pct" value="100" min="1" max="100" step="0.1">
                        </div>
                        <!-- Pixel values (read-only info) -->
                        <div class="property-row" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                            <span style="color: #666; font-size: 11px;">Pixels: <span id="prop-pixels-info">0, 0 - 1920 x 1080</span></span>
                        </div>
                    </div>

                    <!-- Appearance -->
                    <div class="properties-section">
                        <div class="section-title">Appearance</div>
                        <div class="property-row">
                            <span class="property-label">Opacity</span>
                            <input type="range" class="property-slider" id="prop-opacity" min="0" max="100" value="100">
                            <input type="number" class="property-input property-input-sm" id="prop-opacity-value" value="100" min="0" max="100">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Fill</span>
                            <select class="property-select" id="prop-background-type" style="flex: 0 0 100px;">
                                <option value="none">None (Overlay)</option>
                                <option value="solid">Solid Color</option>
                            </select>
                        </div>
                        <div class="property-row" id="background-color-row" style="display: none;">
                            <span class="property-label">Color</span>
                            <div class="color-picker-wrapper">
                                <input type="text" class="property-input" id="prop-background" value="#000000" placeholder="#000000">
                            </div>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Border</span>
                            <input type="number" class="property-input property-input-sm" id="prop-border-width" value="0" min="0" max="20">
                            <input type="text" class="property-input" id="prop-border-color" value="#333333">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Radius</span>
                            <input type="number" class="property-input property-input-sm" id="prop-border-radius" value="0" min="0" max="100">
                        </div>
                    </div>

                    <!-- Layer Options -->
                    <div class="properties-section">
                        <div class="section-title">Layer Options</div>
                        <div class="property-row">
                            <span class="property-label">Name</span>
                            <input type="text" class="property-input" id="prop-name" value="" placeholder="Layer name">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Fit Mode</span>
                            <select class="property-select" id="prop-fit-mode">
                                <option value="cover">Cover</option>
                                <option value="contain">Contain</option>
                                <option value="fill">Fill</option>
                                <option value="none">None</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Z-Index</span>
                            <input type="number" class="property-input property-input-sm" id="prop-z-index" value="0" readonly>
                            <div class="panel-btn-group">
                                <button class="panel-btn panel-btn-icon" id="prop-z-up" title="Bring Forward">&#8593;</button>
                                <button class="panel-btn panel-btn-icon" id="prop-z-down" title="Send Backward">&#8595;</button>
                            </div>
                        </div>
                    </div>

                    <!-- Layer Type & Content -->
                    <div class="properties-section">
                        <div class="section-title">Layer Type</div>
                        <div class="property-row">
                            <select class="property-select" id="prop-layer-type" style="width: 100%;">
                                <option value="content">üì∫ Media Content</option>
                                <option value="weather">üå§Ô∏è Weather Widget</option>
                                <option value="ticker">üì∞ RSS News Ticker</option>
                                <option value="clock">üïê Clock / Time</option>
                                <option value="text">üìù Static Text</option>
                                <option value="html">üåê Custom HTML</option>
                            </select>
                        </div>
                    </div>

                    <!-- Content Source Section -->
                    <div class="properties-section" id="content-source-section">
                        <div class="section-title">Content Source</div>
                        <div class="property-row">
                            <span class="property-label">Source</span>
                            <select class="property-select" id="prop-content-source">
                                <option value="none">None (Empty)</option>
                                <option value="playlist">Playlist</option>
                                <option value="static">Static Content</option>
                                <option value="widget">Widget</option>
                            </select>
                        </div>

                        <!-- Playlist Selector (shown when source=playlist) -->
                        <div id="playlist-selector-row" class="property-row" style="display: none;">
                            <span class="property-label">Playlist</span>
                            <select class="property-select" id="prop-playlist-id">
                                <option value="">-- Select Playlist --</option>
                                {% for playlist in playlists %}
                                <option value="{{ playlist.id }}">{{ playlist.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Static Content Selector (shown when source=static) -->
                        <div id="content-selector-row" class="property-row" style="display: none;">
                            <span class="property-label">Content</span>
                            <select class="property-select" id="prop-content-id">
                                <option value="">-- Select Content --</option>
                                {% for item in content %}
                                <option value="{{ item.id }}">{{ item.original_name or item.filename }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Primary Layer Toggle -->
                        <div class="property-row" id="primary-layer-row">
                            <span class="property-label">Primary</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="prop-is-primary">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="property-hint">Responds to triggers</span>
                        </div>
                    </div>

                    <!-- Weather Widget Config -->
                    <div class="properties-section widget-config" id="config-weather" style="display: none;">
                        <div class="section-title">Weather Settings</div>
                        <div class="property-row">
                            <span class="property-label">Location</span>
                            <input type="text" class="property-input" id="weather-location" placeholder="City, State or ZIP">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Units</span>
                            <select class="property-select" id="weather-units">
                                <option value="imperial">¬∞F (Imperial)</option>
                                <option value="metric">¬∞C (Metric)</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Display</span>
                            <select class="property-select" id="weather-display">
                                <option value="current">Current Only</option>
                                <option value="forecast">5-Day Forecast</option>
                                <option value="detailed">Detailed (Humidity, Wind)</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Style</span>
                            <select class="property-select" id="weather-style">
                                <option value="minimal">Minimal</option>
                                <option value="card">Card</option>
                                <option value="full">Full Width</option>
                            </select>
                        </div>
                    </div>

                    <!-- RSS Ticker Config -->
                    <div class="properties-section widget-config" id="config-ticker" style="display: none;">
                        <div class="section-title">News Ticker Settings</div>
                        <div class="property-row">
                            <span class="property-label">Feed URL</span>
                            <input type="text" class="property-input" id="ticker-feed-url" placeholder="https://example.com/rss">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Speed</span>
                            <select class="property-select" id="ticker-speed">
                                <option value="slow">Slow</option>
                                <option value="medium" selected>Medium</option>
                                <option value="fast">Fast</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Direction</span>
                            <select class="property-select" id="ticker-direction">
                                <option value="left">‚Üê Left</option>
                                <option value="right">Right ‚Üí</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Max Items</span>
                            <input type="number" class="property-input property-input-sm" id="ticker-max-items" value="10" min="1" max="50">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Separator</span>
                            <input type="text" class="property-input property-input-sm" id="ticker-separator" value="‚Ä¢" style="width: 50px;">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Font Size</span>
                            <input type="number" class="property-input property-input-sm" id="ticker-font-size" value="24" min="12" max="72">
                            <span style="color: #888;">px</span>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Text Color</span>
                            <input type="text" class="property-input" id="ticker-text-color" value="#FFFFFF">
                        </div>
                    </div>

                    <!-- Clock Widget Config -->
                    <div class="properties-section widget-config" id="config-clock" style="display: none;">
                        <div class="section-title">Clock Settings</div>
                        <div class="property-row">
                            <span class="property-label">Format</span>
                            <select class="property-select" id="clock-format">
                                <option value="12h">12-Hour (3:45 PM)</option>
                                <option value="24h">24-Hour (15:45)</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Show</span>
                            <select class="property-select" id="clock-show">
                                <option value="time">Time Only</option>
                                <option value="date">Date Only</option>
                                <option value="both">Time & Date</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Timezone</span>
                            <select class="property-select" id="clock-timezone">
                                <option value="local">Local (Device)</option>
                                <option value="America/New_York">Eastern</option>
                                <option value="America/Chicago">Central</option>
                                <option value="America/Denver">Mountain</option>
                                <option value="America/Los_Angeles">Pacific</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Font Size</span>
                            <input type="number" class="property-input property-input-sm" id="clock-font-size" value="48" min="12" max="200">
                            <span style="color: #888;">px</span>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Text Color</span>
                            <input type="text" class="property-input" id="clock-text-color" value="#FFFFFF">
                        </div>
                    </div>

                    <!-- Static Text Config -->
                    <div class="properties-section widget-config" id="config-text" style="display: none;">
                        <div class="section-title">Text Settings</div>
                        <div class="property-row" style="flex-direction: column; align-items: stretch;">
                            <span class="property-label" style="margin-bottom: 8px;">Text Content</span>
                            <textarea class="property-input" id="text-content" rows="3" placeholder="Enter your text here..."></textarea>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Font Size</span>
                            <input type="number" class="property-input property-input-sm" id="text-font-size" value="32" min="8" max="200">
                            <span style="color: #888;">px</span>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Font</span>
                            <select class="property-select" id="text-font-family">
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Helvetica, sans-serif">Helvetica</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                            </select>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Color</span>
                            <input type="text" class="property-input" id="text-color" value="#FFFFFF">
                        </div>
                        <div class="property-row">
                            <span class="property-label">Align</span>
                            <select class="property-select" id="text-align">
                                <option value="left">Left</option>
                                <option value="center">Center</option>
                                <option value="right">Right</option>
                            </select>
                        </div>
                    </div>

                    <!-- Custom HTML Config -->
                    <div class="properties-section widget-config" id="config-html" style="display: none;">
                        <div class="section-title">Custom HTML</div>
                        <div class="property-row" style="flex-direction: column; align-items: stretch;">
                            <span class="property-label" style="margin-bottom: 8px;">HTML URL or Embed Code</span>
                            <textarea class="property-input" id="html-content" rows="4" placeholder="https://example.com/widget or &lt;iframe&gt;..."></textarea>
                        </div>
                        <div class="property-row">
                            <span class="property-label">Refresh</span>
                            <select class="property-select" id="html-refresh">
                                <option value="0">Never</option>
                                <option value="60">Every Minute</option>
                                <option value="300">Every 5 Minutes</option>
                                <option value="900">Every 15 Minutes</option>
                                <option value="3600">Every Hour</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div><!-- End designer-content -->
</div><!-- End designer-wrapper -->
{% endblock %}

{% block extra_scripts %}
<!-- jQuery (required for Spectrum color picker) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<!-- Fabric.js for canvas manipulation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>

<!-- Spectrum Color Picker v2 (maintained fork with alpha support) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2@2.0.10/dist/spectrum.min.css">
<script src="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2@2.0.10/dist/spectrum.min.js"></script>

<script>
    // Layout data from server
    window.LAYOUT_DATA = {
        id: "{{ layout.id }}",
        name: "{{ layout.name }}",
        canvasWidth: {{ layout.canvas_width }},
        canvasHeight: {{ layout.canvas_height }},
        backgroundType: "{{ layout.background_type or 'solid' }}",
        backgroundColor: "{{ layout.background_color or '#000000' }}",
        backgroundOpacity: {{ layout.background_opacity or 1.0 }},
        layers: {{ layers|tojson|safe }}
    };

    // API Endpoints
    window.API_ENDPOINTS = {
        layout: "/api/v1/layouts/{{ layout.id }}",
        layers: "/api/v1/layouts/{{ layout.id }}/layers",
        reorder: "/api/v1/layouts/{{ layout.id }}/layers/reorder"
    };
</script>

<!-- CMS API Helper (required for AJAX calls) -->
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<!-- Fabric Extensions (custom behaviors) -->
<script src="{{ url_for('static', filename='js/fabric-extensions.js') }}"></script>

<!-- Layer Panel -->
<script src="{{ url_for('static', filename='js/layer-panel.js') }}"></script>

<!-- Properties Panel -->
<script src="{{ url_for('static', filename='js/properties-panel.js') }}"></script>

<!-- Layout Designer -->
<script src="{{ url_for('static', filename='js/layout-designer.js') }}"></script>
{% endblock %}
